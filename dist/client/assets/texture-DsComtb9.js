import{c as e}from"./observable-8SYwW91n.js";import{b as t,c as n,d as r,e as i,f as a,h as o,j as s,l as c,m as l}from"./math.vector-Z6V1-M8S.js";import{b as u,c as d}from"./typeStore-CBdYsNuw.js";import{b as f}from"./engineStore-ChlzyWX_.js";import{b as p,j as m,k as h}from"./math.scalar.functions-DzEGaKm0.js";import{L as g,z as _}from"./tools.functions-Cy84Um-0.js";import{b as v,c as y,l as b}from"./guid-yfrujmXZ.js";function x(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}const S={},C={};function w(e){let t=e.getClassName();return C[t]||(C[t]={}),C[t]}function T(e){let t=e.getClassName();if(S[t])return S[t];S[t]={};let n=S[t],r=e,i=t;for(;i;){let e=C[i];for(let t in e)n[t]=e[t];let t,a=!1;do{if(t=Object.getPrototypeOf(r),!t.getClassName){a=!0;break}if(t.getClassName()!==i)break;r=t}while(t);if(a)break;i=t.getClassName(),r=t}return n}function E(e,t){return(n,r)=>{let i=w(n);i[r]||(i[r]={type:e,sourceName:t})}}function D(e,t=null){return(n,r)=>{let i=t||`_`+r;Object.defineProperty(n,r,{get:function(){return this[i]},set:function(t){typeof this[i]?.equals==`function`&&this[i].equals(t)||this[i]!==t&&(this[i]=t,n[e].apply(this))},enumerable:!0,configurable:!0})}}function ee(e,t=null){return D(e,t)}function O(e){return E(0,e)}function k(e){return E(1,e)}function A(e){return E(2,e)}function j(e){return E(3,e)}function M(e){return E(4,e)}function N(e){return E(5,e)}function P(e){return E(6,e)}function te(e){return E(7,e)}function ne(e){return E(8,e)}function re(e){return E(9,e)}function ie(e){return E(10,e)}function ae(e){return E(12,e)}function oe(e){return E(11,e)}function F(e,t,n,r){let i=n.value;n.value=(...n)=>{let a=i;if(typeof _native<`u`&&_native[t]){let e=_native[t];a=r?(...t)=>r(...t)?e(...t):i(...t):e}return e[t]=a,a(...n)}}F.filter=function(e){return(t,n,r)=>F(t,n,r,e)};var I=class e{static Eval(t,n){return t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,t=>(t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,n))):e._HandleParenthesisContent(t,n),t===`true`?!0:t===`false`?!1:e.Eval(t,n)}static _HandleParenthesisContent(t,n){n||=(e=>e===`true`);let r,i=t.split(`||`);for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)){let a=e._SimplifyNegation(i[t].trim()),o=a.split(`&&`);if(o.length>1)for(let t=0;t<o.length;++t){let i=e._SimplifyNegation(o[t].trim());if(r=i!==`true`&&i!==`false`?i[0]===`!`?!n(i.substring(1)):n(i):i===`true`,!r){a=`false`;break}}if(r||a===`true`){r=!0;break}r=a!==`true`&&a!==`false`?a[0]===`!`?!n(a.substring(1)):n(a):a===`true`}return r?`true`:`false`}static _SimplifyNegation(e){return e=e.replace(/^[\s!]+/,e=>(e=e.replace(/[\s]/g,()=>``),e.length%2?`!`:``)),e=e.trim(),e===`!true`?e=`false`:e===`!false`&&(e=`true`),e}},L=class e{static EnableFor(t){t._tags=t._tags||{},t.hasTags=()=>e.HasTags(t),t.addTags=n=>e.AddTagsTo(t,n),t.removeTags=n=>e.RemoveTagsFrom(t,n),t.matchesTagsQuery=n=>e.MatchesQuery(t,n)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;let t=e._tags;for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(t){let t=[];for(let n in e._tags)Object.prototype.hasOwnProperty.call(e._tags,n)&&e._tags[n]===!0&&t.push(n);return t.join(` `)}else return e._tags}static AddTagsTo(t,n){if(!n||typeof n!=`string`)return;let r=n.split(` `);for(let n of r)e._AddTagTo(t,n)}static _AddTagTo(t,n){n=n.trim(),!(n===``||n===`true`||n===`false`)&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[n]=!0))}static RemoveTagsFrom(t,n){if(!e.HasTags(t))return;let r=n.split(` `);for(let n in r)e._RemoveTagFrom(t,r[n])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(t,n){return n===void 0?!0:n===``?e.HasTags(t):I.Eval(n,n=>e.HasTags(t)&&t._tags[n])}};function R(e){return e**+l}function z(e){return e<=.04045?.0773993808*e:(.947867299*(e+.055))**2.4}function B(e){return e**+c}function V(e){return e<=.0031308?12.92*e:1.055*e**.41666-.055}var H=class e{constructor(e=0,t=0,n=0){this.r=e,this.g=t,this.b=n}toString(){return`{R: `+this.r+` G:`+this.g+` B:`+this.b+`}`}getClassName(){return`Color3`}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(t,n=0){return e.FromArrayToRef(t,n,this),this}toColor4(e=1){return new U(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return this.r*.3+this.g*.59+this.b*.11}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(t,n,r){return new e(this.r*t,this.g*n,this.b*r)}divide(e){throw ReferenceError(`Can not divide a color`)}divideToRef(e,t){throw ReferenceError(`Can not divide a color`)}divideInPlace(e){throw ReferenceError(`Can not divide a color`)}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,n){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(n,this.b),this}maximizeInPlaceFromFloats(e,t,n){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(n,this.b),this}floorToRef(e){throw ReferenceError(`Can not floor a color`)}floor(){throw ReferenceError(`Can not floor a color`)}fractToRef(e){throw ReferenceError(`Can not fract a color`)}fract(){throw ReferenceError(`Can not fract a color`)}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,n){return this.equalsToFloats(e,t,n)}equalsToFloats(e,t,n){return this.r===e&&this.g===t&&this.b===n}equalsWithEpsilon(e,t=s){return h(this.r,e.r,t)&&h(this.g,e.g,t)&&h(this.b,e.b,t)}negate(){throw ReferenceError(`Can not negate a color`)}negateInPlace(){throw ReferenceError(`Can not negate a color`)}negateToRef(e){throw ReferenceError(`Can not negate a color`)}scale(t){return new e(this.r*t,this.g*t,this.b*t)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,n){return n.r=p(this.r,e,t),n.g=p(this.g,e,t),n.b=p(this.b,e,t),n}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,n){return this.r+=e,this.g+=t,this.b+=n,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(t,n,r){return new e(this.r-t,this.g-n,this.b-r)}subtractFromFloatsToRef(e,t,n,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-n,r}clone(){return new e(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,n){return this.r=e,this.g=t,this.b=n,this}set(e,t,n){return this.copyFromFloats(e,t,n)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){let e=Math.round(this.r*255),t=Math.round(this.g*255),n=Math.round(this.b*255);return`#`+m(e)+m(t)+m(n)}fromHexString(e){return e.substring(0,1)!==`#`||e.length!==7?this:(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,this)}toHSV(){return this.toHSVToRef(new e)}toHSVToRef(e){let t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),a=Math.min(t,n,r),o=0,s=0,c=i,l=i-a;return i!==0&&(s=l/i),i!=a&&(i==t?(o=(n-r)/l,n<r&&(o+=6)):i==n?o=(r-t)/l+2:i==r&&(o=(t-n)/l+4),o*=60),e.r=o,e.g=s,e.b=c,e}toLinearSpace(t=!1){let n=new e;return this.toLinearSpaceToRef(n,t),n}toLinearSpaceToRef(e,t=!1){return t?(e.r=z(this.r),e.g=z(this.g),e.b=z(this.b)):(e.r=R(this.r),e.g=R(this.g),e.b=R(this.b)),this}toGammaSpace(t=!1){let n=new e;return this.toGammaSpaceToRef(n,t),n}toGammaSpaceToRef(e,t=!1){return t?(e.r=V(this.r),e.g=V(this.g),e.b=V(this.b)):(e.r=B(this.r),e.g=B(this.g),e.b=B(this.b)),this}static HSVtoRGBToRef(e,t,n,r){let i=n*t,a=e/60,o=i*(1-Math.abs(a%2-1)),s=0,c=0,l=0;a>=0&&a<=1?(s=i,c=o):a>=1&&a<=2?(s=o,c=i):a>=2&&a<=3?(c=i,l=o):a>=3&&a<=4?(c=o,l=i):a>=4&&a<=5?(s=o,l=i):a>=5&&a<=6&&(s=i,l=o);let u=n-i;return r.r=s+u,r.g=c+u,r.b=l+u,r}static FromHSV(t,n,r){let i=new e(0,0,0);return e.HSVtoRGBToRef(t,n,r,i),i}static FromHexString(t){return new e(0,0,0).fromHexString(t)}static FromArray(t,n=0){return new e(t[n],t[n+1],t[n+2])}static FromArrayToRef(e,t=0,n){n.r=e[t],n.g=e[t+1],n.b=e[t+2]}static FromInts(t,n,r){return new e(t/255,n/255,r/255)}static Lerp(t,n,r){let i=new e(0,0,0);return e.LerpToRef(t,n,r,i),i}static LerpToRef(e,t,n,r){r.r=e.r+(t.r-e.r)*n,r.g=e.g+(t.g-e.g)*n,r.b=e.b+(t.b-e.b)*n}static Hermite(t,n,r,i,a){let o=a*a,s=a*o,c=2*s-3*o+1,l=-2*s+3*o,u=s-2*o+a,d=s-o,f=t.r*c+r.r*l+n.r*u+i.r*d,p=t.g*c+r.g*l+n.g*u+i.g*d,m=t.b*c+r.b*l+n.b*u+i.b*d;return new e(f,p,m)}static Hermite1stDerivative(t,n,r,i,a){let o=e.Black();return this.Hermite1stDerivativeToRef(t,n,r,i,a,o),o}static Hermite1stDerivativeToRef(e,t,n,r,i,a){let o=i*i;a.r=(o-i)*6*e.r+(3*o-4*i+1)*t.r+(-o+i)*6*n.r+(3*o-2*i)*r.r,a.g=(o-i)*6*e.g+(3*o-4*i+1)*t.g+(-o+i)*6*n.g+(3*o-2*i)*r.g,a.b=(o-i)*6*e.b+(3*o-4*i+1)*t.b+(-o+i)*6*n.b+(3*o-2*i)*r.b}static Red(){return new e(1,0,0)}static Green(){return new e(0,1,0)}static Blue(){return new e(0,0,1)}static Black(){return new e(0,0,0)}static get BlackReadOnly(){return e._BlackReadOnly}static White(){return new e(1,1,1)}static Purple(){return new e(.5,0,.5)}static Magenta(){return new e(1,0,1)}static Yellow(){return new e(1,1,0)}static Gray(){return new e(.5,.5,.5)}static Teal(){return new e(0,1,1)}static Random(){return new e(Math.random(),Math.random(),Math.random())}};H._V8PerformanceHack=new H(.5,.5,.5),H._BlackReadOnly=H.Black(),Object.defineProperties(H.prototype,{dimension:{value:[3]},rank:{value:1}});var U=class e{constructor(e=0,t=0,n=0,r=1){this.r=e,this.g=t,this.b=n,this.a=r}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,n,r){return this.r+=e,this.g+=t,this.b+=n,this.a+=r,this}subtract(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(t,n,r,i){return new e(this.r-t,this.g-n,this.b-r,this.a-i)}subtractFromFloatsToRef(e,t,n,r,i){return i.r=this.r-e,i.g=this.g-t,i.b=this.b-n,i.a=this.a-r,i}scale(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,n){return n.r=p(this.r,e,t),n.g=p(this.g,e,t),n.b=p(this.b,e,t),n.a=p(this.a,e,t),n}multiply(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(t,n,r,i){return new e(this.r*t,this.g*n,this.b*r,this.a*i)}divide(e){throw ReferenceError(`Can not divide a color`)}divideToRef(e,t){throw ReferenceError(`Can not divide a color`)}divideInPlace(e){throw ReferenceError(`Can not divide a color`)}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,n,r){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(n,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(e,t,n,r){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(n,this.b),this.a=Math.max(r,this.a),this}floorToRef(e){throw ReferenceError(`Can not floor a color`)}floor(){throw ReferenceError(`Can not floor a color`)}fractToRef(e){throw ReferenceError(`Can not fract a color`)}fract(){throw ReferenceError(`Can not fract a color`)}negate(){throw ReferenceError(`Can not negate a color`)}negateInPlace(){throw ReferenceError(`Can not negate a color`)}negateToRef(e){throw ReferenceError(`Can not negate a color`)}equalsWithEpsilon(e,t=s){return h(this.r,e.r,t)&&h(this.g,e.g,t)&&h(this.b,e.b,t)&&h(this.a,e.a,t)}equalsToFloats(e,t,n,r){return this.r===e&&this.g===t&&this.b===n&&this.a===r}toString(){return`{R: `+this.r+` G:`+this.g+` B:`+this.b+` A:`+this.a+`}`}getClassName(){return`Color4`}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e=e*397^(this.a*255|0),e}clone(){let t=new e;return t.copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,n,r){return this.r=e,this.g=t,this.b=n,this.a=r,this}set(e,t,n,r){return this.copyFromFloats(e,t,n,r)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){let t=Math.round(this.r*255),n=Math.round(this.g*255),r=Math.round(this.b*255);if(e)return`#`+m(t)+m(n)+m(r);let i=Math.round(this.a*255);return`#`+m(t)+m(n)+m(r)+m(i)}fromHexString(e){return e.substring(0,1)!==`#`||e.length!==9&&e.length!==7?this:(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,e.length===9&&(this.a=parseInt(e.substring(7,9),16)/255),this)}toLinearSpace(t=!1){let n=new e;return this.toLinearSpaceToRef(n,t),n}toLinearSpaceToRef(e,t=!1){return t?(e.r=z(this.r),e.g=z(this.g),e.b=z(this.b)):(e.r=R(this.r),e.g=R(this.g),e.b=R(this.b)),e.a=this.a,this}toGammaSpace(t=!1){let n=new e;return this.toGammaSpaceToRef(n,t),n}toGammaSpaceToRef(e,t=!1){return t?(e.r=V(this.r),e.g=V(this.g),e.b=V(this.b)):(e.r=B(this.r),e.g=B(this.g),e.b=B(this.b)),e.a=this.a,this}static FromHexString(t){return t.substring(0,1)!==`#`||t.length!==9&&t.length!==7?new e(0,0,0,0):new e(0,0,0,1).fromHexString(t)}static Lerp(t,n,r){return e.LerpToRef(t,n,r,new e)}static LerpToRef(e,t,n,r){return r.r=e.r+(t.r-e.r)*n,r.g=e.g+(t.g-e.g)*n,r.b=e.b+(t.b-e.b)*n,r.a=e.a+(t.a-e.a)*n,r}static Hermite(t,n,r,i,a){let o=a*a,s=a*o,c=2*s-3*o+1,l=-2*s+3*o,u=s-2*o+a,d=s-o,f=t.r*c+r.r*l+n.r*u+i.r*d,p=t.g*c+r.g*l+n.g*u+i.g*d,m=t.b*c+r.b*l+n.b*u+i.b*d,h=t.a*c+r.a*l+n.a*u+i.a*d;return new e(f,p,m,h)}static Hermite1stDerivative(t,n,r,i,a){let o=new e;return this.Hermite1stDerivativeToRef(t,n,r,i,a,o),o}static Hermite1stDerivativeToRef(e,t,n,r,i,a){let o=i*i;a.r=(o-i)*6*e.r+(3*o-4*i+1)*t.r+(-o+i)*6*n.r+(3*o-2*i)*r.r,a.g=(o-i)*6*e.g+(3*o-4*i+1)*t.g+(-o+i)*6*n.g+(3*o-2*i)*r.g,a.b=(o-i)*6*e.b+(3*o-4*i+1)*t.b+(-o+i)*6*n.b+(3*o-2*i)*r.b,a.a=(o-i)*6*e.a+(3*o-4*i+1)*t.a+(-o+i)*6*n.a+(3*o-2*i)*r.a}static FromColor3(t,n=1){return new e(t.r,t.g,t.b,n)}static FromArray(t,n=0){return new e(t[n],t[n+1],t[n+2],t[n+3])}static FromArrayToRef(e,t=0,n){n.r=e[t],n.g=e[t+1],n.b=e[t+2],n.a=e[t+3]}static FromInts(t,n,r,i){return new e(t/255,n/255,r/255,i/255)}static CheckColors4(e,t){if(e.length===t*3){let t=[];for(let n=0;n<e.length;n+=3){let r=n/3*4;t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=1}return t}return e}};U._V8PerformanceHack=new U(.5,.5,.5,.5),Object.defineProperties(U.prototype,{dimension:{value:[4]},rank:{value:1}});var W=class{};W.Color3=o(3,H.Black),W.Color4=o(3,()=>new U(0,0,0,0)),d(`BABYLON.Color3`,H),d(`BABYLON.Color4`,U);const G=function(e,t,n,r={}){let i=e();L&&L.HasTags(t)&&L.AddTagsTo(i,L.GetTags(t,!0));let a=T(i),o={};for(let e in a){let s=a[e],c=t[e],l=s.type;if(c!=null&&(e!==`uniqueId`||K.AllowLoadingUniqueId))switch(l){case 0:case 6:case 9:case 11:i[e]=c;break;case 1:r.cloneTexturesOnlyOnce&&o[c.uniqueId]?i[e]=o[c.uniqueId]:(i[e]=n||c.isRenderTarget?c:c.clone(),o[c.uniqueId]=i[e]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:i[e]=n?c:c.clone();break}}return i};var K=class e{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let n=0;n<e.animations.length;n++){let r=e.animations[n];t.animations.push(r.serialize())}}}static Serialize(t,n){n||={},L&&(n.tags=L.GetTags(t));let r=T(t);for(let i in r){let a=r[i],o=a.sourceName||i,s=a.type,c=t[i];if(c!=null&&(i!==`uniqueId`||e.AllowLoadingUniqueId))switch(s){case 0:n[o]=c;break;case 1:n[o]=c.serialize();break;case 2:n[o]=c.asArray();break;case 3:n[o]=c.serialize();break;case 4:n[o]=c.asArray();break;case 5:n[o]=c.asArray();break;case 6:n[o]=c.id;break;case 7:n[o]=c.serialize();break;case 8:n[o]=c.asArray();break;case 9:n[o]=c.serialize();break;case 10:n[o]=c.asArray();break;case 11:n[o]=c.id;break;case 12:n[o]=c.asArray();break}}return n}static ParseProperties(r,o,s,c){c||=``;let l=T(o);for(let u in l){let d=l[u],f=r[d.sourceName||u],p=d.type;if(f!=null&&(u!==`uniqueId`||e.AllowLoadingUniqueId)){let r=o;switch(p){case 0:r[u]=f;break;case 1:s&&(r[u]=e._TextureParser(f,s,c));break;case 2:r[u]=H.FromArray(f);break;case 3:r[u]=e._FresnelParametersParser(f);break;case 4:r[u]=i.FromArray(f);break;case 5:r[u]=a.FromArray(f);break;case 6:s&&(r[u]=s.getLastMeshById(f));break;case 7:r[u]=e._ColorCurvesParser(f);break;case 8:r[u]=U.FromArray(f);break;case 9:r[u]=e._ImageProcessingConfigurationParser(f);break;case 10:r[u]=n.FromArray(f);break;case 11:s&&(r[u]=s.getCameraById(f));break;case 12:r[u]=t.FromArray(f);break}}}}static Parse(t,n,r,i=null){let a=t();return L&&L.AddTagsTo(a,n.tags),e.ParseProperties(n,a,r,i),a}static Clone(e,t,n={}){return G(e,t,!1,n)}static Instanciate(e,t){return G(e,t,!0)}};K.AllowLoadingUniqueId=!1,K._ImageProcessingConfigurationParser=e=>{throw g(`ImageProcessingConfiguration`)},K._FresnelParametersParser=e=>{throw g(`FresnelParameters`)},K._ColorCurvesParser=e=>{throw g(`ColorCurves`)},K._TextureParser=(e,t,n)=>{throw g(`Texture`)};var q=class e{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return`Size`}getHashCode(){let e=this.width|0;return e=e*397^(this.height|0),e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(t,n){return new e(this.width*t,this.height*n)}clone(){return new e(this.width,this.height)}equals(e){return e?this.width===e.width&&this.height===e.height:!1}get surface(){return this.width*this.height}static Zero(){return new e(0,0)}add(t){let n=new e(this.width+t.width,this.height+t.height);return n}subtract(t){let n=new e(this.width-t.width,this.height-t.height);return n}scale(t){return new e(this.width*t,this.height*t)}static Lerp(t,n,r){let i=t.width+(n.width-t.width)*r,a=t.height+(n.height-t.height)*r;return new e(i,a)}},J=class e{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return this._texture?this._texture.isCube:!1}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return`ThinTexture`}static _IsRenderTargetWrapper(e){return e?.shareDepth!==void 0}constructor(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=q.Zero(),this._cachedBaseSize=q.Zero(),this._initialSamplingMode=2,this._texture=e._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e,t=!1){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture,this._texture.generateMipMaps&&t)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}},Y=class n extends J{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace&&!this._texture._useSRGBBuffer}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this))}get isRGBD(){return this._texture!=null&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return this._texture?this._texture._linearSpecularLOD:!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||=v(),this._uid}toString(){return this.name}getClassName(){return`BaseTexture`}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(t,r=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=n.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?n._IsScene(t)?this._scene=t:this._engine=t:this._scene=f.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=r,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return t.IdentityReadOnly}getReflectionTextureMatrix(){return t.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,n,r,i,a){let o=this._getEngine();if(!o)return null;let s=o._getUseSRGBBuffer(!!i,t),c=o.getLoadedTexturesCache();for(let o=0;o<c.length;o++){let l=c[o];if((i===void 0||s===l._useSRGBBuffer)&&(r===void 0||r===l.invertY)&&l.url===e&&l.generateMipMaps===!t&&(!n||n===l.samplingMode)&&(a===void 0||a===l.isCube))return l.incrementReferences(),l}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture?this._texture.type===void 0?0:this._texture.type:0}get textureFormat(){return this._texture?this._texture.format===void 0?5:this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){let e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,n=null,r=!0,i=!1,a=0,o=0,s=Number.MAX_VALUE,c=Number.MAX_VALUE){if(!this._texture)return null;let l=this._getEngine();if(!l)return null;let u=this.getSize(),d=u.width,f=u.height;t!==0&&(d/=2**t,f/=2**t,d=Math.round(d),f=Math.round(f)),s=Math.min(d,s),c=Math.min(f,c);try{return this._texture.isCube?l._readTexturePixels(this._texture,s,c,e,t,n,r,i,a,o):l._readTexturePixels(this._texture,s,c,-1,t,n,r,i,a,o)}catch{return null}}_readPixelsSync(e=0,t=0,n=null,r=!0,i=!1){if(!this._texture)return null;let a=this.getSize(),o=a.width,s=a.height,c=this._getEngine();if(!c)return null;t!=0&&(o/=2**t,s/=2**t,o=Math.round(o),s=Math.round(s));try{return this._texture.isCube?c._readTexturePixelsSync(this._texture,o,s,e,t,n,r,i):c._readTexturePixelsSync(this._texture,o,s,-1,t,n,r,i)}catch{return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);let e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){let e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;let t=K.Serialize(this);return K.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let n=e.length;if(n===0){t();return}for(let r=0;r<e.length;r++){let i=e[r];if(i.isReady())--n===0&&t();else{let e=i.onLoadObservable;e?e.addOnce(()=>{--n===0&&t()}):--n===0&&t()}}}static _IsScene(e){return e.getClassName()===`Scene`}};Y.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,x([O()],Y.prototype,`uniqueId`,void 0),x([O()],Y.prototype,`name`,void 0),x([O()],Y.prototype,`displayName`,void 0),x([O()],Y.prototype,`metadata`,void 0),x([O(`hasAlpha`)],Y.prototype,`_hasAlpha`,void 0),x([O(`getAlphaFromRGB`)],Y.prototype,`_getAlphaFromRGB`,void 0),x([O()],Y.prototype,`level`,void 0),x([O(`coordinatesIndex`)],Y.prototype,`_coordinatesIndex`,void 0),x([O()],Y.prototype,`optimizeUVAllocation`,void 0),x([O(`coordinatesMode`)],Y.prototype,`_coordinatesMode`,void 0),x([O()],Y.prototype,`wrapU`,null),x([O()],Y.prototype,`wrapV`,null),x([O()],Y.prototype,`wrapR`,void 0),x([O()],Y.prototype,`anisotropicFilteringLevel`,void 0),x([O()],Y.prototype,`isCube`,null),x([O()],Y.prototype,`is3D`,null),x([O()],Y.prototype,`is2DArray`,null),x([O()],Y.prototype,`gammaSpace`,null),x([O()],Y.prototype,`invertZ`,void 0),x([O()],Y.prototype,`lodLevelInAlpha`,void 0),x([O()],Y.prototype,`lodGenerationOffset`,null),x([O()],Y.prototype,`lodGenerationScale`,null),x([O()],Y.prototype,`linearSpecularLOD`,null),x([k()],Y.prototype,`irradianceTexture`,null),x([O()],Y.prototype,`isRenderTarget`,void 0);var X=class e{constructor(e,t,n,r){this.normal=new a(e,t,n),this.d=r}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return`Plane`}getHashCode(){let e=this.normal.getHashCode();return e=e*397^(this.d|0),e}normalize(){let e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return e!==0&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(t){let n=e._TmpMatrix;t.invertToRef(n);let r=n.m,i=this.normal.x,a=this.normal.y,o=this.normal.z,s=this.d,c=i*r[0]+a*r[1]+o*r[2]+s*r[3],l=i*r[4]+a*r[5]+o*r[6]+s*r[7],u=i*r[8]+a*r[9]+o*r[10]+s*r[11],d=i*r[12]+a*r[13]+o*r[14]+s*r[15];return new e(c,l,u,d)}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,n){let r=t.x-e.x,i=t.y-e.y,a=t.z-e.z,o=n.x-e.x,s=n.y-e.y,c=n.z-e.z,l=i*c-a*s,u=a*o-r*c,d=r*s-i*o,f=Math.sqrt(l*l+u*u+d*d),p;return p=f===0?0:1/f,this.normal.x=l*p,this.normal.y=u*p,this.normal.z=d*p,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){let n=a.Dot(this.normal,e);return n<=t}signedDistanceTo(e){return a.Dot(e,this.normal)+this.d}static FromArray(t){return new e(t[0],t[1],t[2],t[3])}static FromPoints(t,n,r){let i=new e(0,0,0,0);return i.copyFromPoints(t,n,r),i}static FromPositionAndNormal(t,n){let r=new e(0,0,0,0);return this.FromPositionAndNormalToRef(t,n,r)}static FromPositionAndNormalToRef(e,t,n){return n.normal.copyFrom(t),n.normal.normalize(),n.d=-e.dot(n.normal),n}static SignedDistanceToPlaneFromPositionAndNormal(e,t,n){let r=-(t.x*e.x+t.y*e.y+t.z*e.z);return a.Dot(n,t)+r}};X._TmpMatrix=t.Identity();function Z(e,t,n=!1){let r=t.width,i=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT,n=new Uint8Array(t);for(;--t>=0;){let r=e[t];r<0?r=0:r>1&&(r=1),n[t]=r*255}e=n}let a=document.createElement(`canvas`);a.width=r,a.height=i;let o=a.getContext(`2d`);if(!o)return null;let s=o.createImageData(r,i),c=s.data;if(c.set(e),o.putImageData(s,0,0),n){let e=document.createElement(`canvas`);e.width=r,e.height=i;let t=e.getContext(`2d`);return t?(t.translate(0,i),t.scale(1,-1),t.drawImage(a,0,0),e.toDataURL(`image/png`)):null}return a.toDataURL(`image/png`)}function se(e,t=0,n=0){let r=e.getInternalTexture();if(!r)return null;let i=e._readPixelsSync(t,n);return i?Z(i,e.getSize(),r.invertY):null}async function ce(e,t=0,n=0){let r=e.getInternalTexture();if(!r)return null;let i=await e.readPixels(t,n);return i?Z(i,e.getSize(),r.invertY):null}let Q=!1;var $=class n extends Y{static _CreateVideoTexture(e,t,r,i=!1,a=!1,o=n.TRILINEAR_SAMPLINGMODE,s={},c,l=5){throw g(`VideoTexture`)}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(t,r,i,a,o=n.TRILINEAR_SAMPLINGMODE,s=null,c=null,l=null,u=!1,d,f,p,m,h){super(r),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new e,this._isBlocking=!0,this.name=t||``,this.url=t;let g,v=!1,y=null,b=!0;typeof i==`object`&&i?(g=i.noMipmap??!1,a=i.invertY??!Q,o=i.samplingMode??n.TRILINEAR_SAMPLINGMODE,s=i.onLoad??null,c=i.onError??null,l=i.buffer??null,u=i.deleteBuffer??!1,d=i.format,f=i.mimeType,p=i.loaderOptions,m=i.creationFlags,v=i.useSRGBBuffer??!1,y=i.internalTexture??null,b=i.gammaSpace??b,h=i.forcedExtension??h):g=!!i,this._gammaSpace=b,this._noMipmap=g,this._invertY=a===void 0?!Q:a,this._initialSamplingMode=o,this._buffer=l,this._deleteBuffer=u,this._mimeType=f,this._loaderOptions=p,this._creationFlags=m,this._useSRGBBuffer=v,this._forcedExtension=h,d!==void 0&&(this._format=d);let x=this.getScene(),S=this._getEngine();if(!S)return;S.onBeforeTextureInitObservable.notifyObservers(this);let C=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),this._texture._cachedWrapU!==null&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),this._texture._cachedWrapV!==null&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),this._texture._cachedWrapR!==null&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),s&&s(),!this.isBlocking&&x&&x.resetCachedMaterial()},w=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},c&&c(e,t),n.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!y){this._delayedOnLoad=C,this._delayedOnError=w;return}if(this._texture=y??this._getFromCache(this.url,g,o,this._invertY,v,this.isCube),this._texture)if(this._texture.isReady)_.SetImmediate(()=>C());else{let e=this._texture.onLoadedObservable.add(C);this._texture.onErrorObservable.add(t=>{w(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)})}else if(!x||!x.useDelayedTextureLoading){try{this._texture=S.createTexture(this.url,g,this._invertY,x,o,C,w,this._buffer,void 0,this._format,this._forcedExtension,f,p,m,v)}catch(e){throw w(`error loading`,e),e}u&&(this._buffer=null)}else this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=w}updateURL(e,t=null,n,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,e=>e.hasTexture(this))),(!this.name||this.name.startsWith(`data:`))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4,n&&(this._delayedOnLoad=n),this.delayLoad()}delayLoad(){if(this.delayLoadState!==4)return;let e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?_.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,n,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,n-=this.wRotationCenter,a.TransformCoordinatesFromFloatsToRef(e,t,n,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=t.Zero(),this._rowGenerationMatrix=new t,this._t0=a.Zero(),this._t1=a.Zero(),this._t2=a.Zero()),t.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(t.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,r.Matrix[0]),t.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,r.Matrix[1]),t.ScalingToRef(this._cachedUScale,this._cachedVScale,0,r.Matrix[2]),t.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,r.Matrix[3]),r.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(r.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(r.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(r.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),t.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));let n=this.getScene();if(!n)return this._cachedTextureMatrix;let i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&n.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedTextureMatrix}getReflectionTextureMatrix(){let e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode)if(this.coordinatesMode===n.PROJECTION_MODE){if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}else return this._cachedReflectionTextureMatrix;this._cachedReflectionTextureMatrix||=t.Zero(),this._projectionModeMatrix||=t.Zero();let r=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case n.PLANAR_MODE:t.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case n.PROJECTION_MODE:{t.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);let n=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:t.IdentityToRef(this._cachedReflectionTextureMatrix);break}return r&&e.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){let e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return K.Clone(()=>new n(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){let e=this.name;n.SerializeBuffers||this.name.startsWith(`data:`)&&(this.name=``),this.name.startsWith(`data:`)&&this.url===this.name&&(this.url=``);let t=super.serialize(n._SerializeInternalTextureUniqueId);if(!t)return null;if(n.SerializeBuffers||n.ForceSerializeBuffers)if(typeof this._buffer==`string`&&this._buffer.startsWith(`data:`))t.base64String=this._buffer,t.name=t.name.replace(`data:`,``);else if(this.url&&this.url.startsWith(`data:`)&&this._buffer instanceof Uint8Array){let e=this.mimeType||`image/png`;t.base64String=`data:${e};base64,${b(this._buffer)}`}else (n.ForceSerializeBuffers||this.url&&this.url.startsWith(`blob:`)||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?se(this):ce(this));return t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,n._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId),t.internalTextureLabel=this._texture?.label,t.noMipmap=this._noMipmap,this.name=e,t}getClassName(){return`Texture`}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,r){if(e.customType){let n=y.Instantiate(e.customType),i=n.Parse(e,t,r);return e.samplingMode&&i.updateSamplingMode&&i._samplingMode&&i._samplingMode!==e.samplingMode&&i.updateSamplingMode(e.samplingMode),i}if(e.isCube&&!e.isRenderTarget)return n._CubeTextureParser(e,t,r);let i=e.internalTextureUniqueId!==void 0;if(!e.name&&!e.isRenderTarget&&!i)return null;let a;if(i){let n=t.getEngine().getLoadedTexturesCache();for(let t of n)if(t.uniqueId===e.internalTextureUniqueId){a=t;break}}let o=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){let n=e.samplingMode;t&&t.samplingMode!==n&&t.updateSamplingMode(n)}if(t&&e.animations)for(let n=0;n<e.animations.length;n++){let r=e.animations[n],i=u(`BABYLON.Animation`);i&&t.animations.push(i.Parse(r))}t&&t._texture&&(i&&!a&&t._texture._setUniqueId(e.internalTextureUniqueId),t._texture.label=e.internalTextureLabel)},s=K.Parse(()=>{let i=!0;if(e.noMipmap&&(i=!1),e.mirrorPlane){let r=n._CreateMirror(e.name,e.renderTargetSize,t,i);return r._waitingRenderList=e.renderList,r.mirrorPlane=X.FromArray(e.mirrorPlane),o(r),r}else if(e.isRenderTarget){let r=null;if(e.isCube){if(t.reflectionProbes)for(let n=0;n<t.reflectionProbes.length;n++){let r=t.reflectionProbes[n];if(r.name===e.name)return r.cubeTexture}}else r=n._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,i,e._creationFlags??0),r._waitingRenderList=e.renderList;return o(r),r}else if(e.isVideo){let a=n._CreateVideoTexture(r+(e.url||e.name),r+(e.src||e.url),t,i,e.invertY,e.samplingMode,e.settings||{});return o(a),a}else{let s;if(e.base64String&&!a)s=n.CreateFromBase64String(e.base64String,e.base64String,t,!i,e.invertY,e.samplingMode,()=>{o(s)},e._creationFlags??0,e._useSRGBBuffer??!1),s.name=e.name;else{let c;c=e.name&&(e.name.indexOf(`://`)>0||e.name.startsWith(`data:`))?e.name:r+e.name,e.url&&(e.url.startsWith(`data:`)||n.UseSerializedUrlIfAny)&&(c=e.url);let l={noMipmap:!i,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{o(s)},internalTexture:a};s=new n(c,t,l)}return s}},e,t);return s}static CreateFromBase64String(e,t,r,i,a,o=n.TRILINEAR_SAMPLINGMODE,s=null,c=null,l=5,u,d){return new n(`data:`+t,r,i,a,o,s,c,e,!1,l,void 0,void 0,u,d)}static LoadFromDataString(e,t,r,i=!1,a,o=!0,s=n.TRILINEAR_SAMPLINGMODE,c=null,l=null,u=5,d,f){return e.substring(0,5)!==`data:`&&(e=`data:`+e),new n(e,r,a,o,s,c,l,t,i,u,void 0,void 0,d,f)}};$.SerializeBuffers=!0,$.ForceSerializeBuffers=!1,$.OnTextureLoadErrorObservable=new e,$._SerializeInternalTextureUniqueId=!1,$._CubeTextureParser=(e,t,n)=>{throw g(`CubeTexture`)},$._CreateMirror=(e,t,n,r)=>{throw g(`MirrorTexture`)},$._CreateRenderTargetTexture=(e,t,n,r,i)=>{throw g(`RenderTargetTexture`)},$.NEAREST_SAMPLINGMODE=1,$.NEAREST_NEAREST_MIPLINEAR=8,$.BILINEAR_SAMPLINGMODE=2,$.LINEAR_LINEAR_MIPNEAREST=11,$.TRILINEAR_SAMPLINGMODE=3,$.LINEAR_LINEAR_MIPLINEAR=3,$.NEAREST_NEAREST_MIPNEAREST=4,$.NEAREST_LINEAR_MIPNEAREST=5,$.NEAREST_LINEAR_MIPLINEAR=6,$.NEAREST_LINEAR=7,$.NEAREST_NEAREST=1,$.LINEAR_NEAREST_MIPNEAREST=9,$.LINEAR_NEAREST_MIPLINEAR=10,$.LINEAR_LINEAR=2,$.LINEAR_NEAREST=12,$.EXPLICIT_MODE=0,$.SPHERICAL_MODE=1,$.PLANAR_MODE=2,$.CUBIC_MODE=3,$.PROJECTION_MODE=4,$.SKYBOX_MODE=5,$.INVCUBIC_MODE=6,$.EQUIRECTANGULAR_MODE=7,$.FIXED_EQUIRECTANGULAR_MODE=8,$.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,$.CLAMP_ADDRESSMODE=0,$.WRAP_ADDRESSMODE=1,$.MIRROR_ADDRESSMODE=2,$.UseSerializedUrlIfAny=!1,x([O()],$.prototype,`url`,void 0),x([O()],$.prototype,`uOffset`,void 0),x([O()],$.prototype,`vOffset`,void 0),x([O()],$.prototype,`uScale`,void 0),x([O()],$.prototype,`vScale`,void 0),x([O()],$.prototype,`uAng`,void 0),x([O()],$.prototype,`vAng`,void 0),x([O()],$.prototype,`wAng`,void 0),x([O()],$.prototype,`uRotationCenter`,void 0),x([O()],$.prototype,`vRotationCenter`,void 0),x([O()],$.prototype,`wRotationCenter`,void 0),x([O()],$.prototype,`homogeneousRotationInUVTransform`,void 0),x([O()],$.prototype,`isBlocking`,null),d(`BABYLON.Texture`,$),K._TextureParser=$.Parse;export{N as A,x as B,$ as b,Q as c,X as d,Y as e,J as f,q as g,K as h,H as i,U as j,W as k,L as l,ee as m,F as n,O as o,oe as p,A as q,ne as r,te as s,j as t,re as u,ae as v,P as w,ie as x,k as y,M as z};