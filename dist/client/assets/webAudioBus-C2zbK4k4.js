import{b as e}from"./abstractAudioBus-D3fKFNq4.js";import{b as t,d as n,f as r,g as i}from"./spatialWebAudio-BAmtw0U_.js";var a=class extends e{constructor(e,t){super(e,t),this._outBus=null,this._onOutBusDisposed=()=>{this.outBus=this.engine.defaultMainBus}}get outBus(){return this._outBus}set outBus(e){if(this._outBus!==e){if(this._outBus&&(this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed),!this._disconnect(this._outBus)))throw Error(`Disconnect failed`);if(this._outBus=e,this._outBus&&(this._outBus.onDisposeObservable.add(this._onOutBusDisposed),!this._connect(this._outBus)))throw Error(`Connect failed`)}}dispose(){super.dispose(),this._outBus=null}},o=class e extends a{constructor(t,n,r){super(t,n),this._spatial=null,this._spatialAutoUpdate=!0,this._spatialMinUpdateTime=0,this._stereo=null,typeof r.spatialAutoUpdate==`boolean`&&(this._spatialAutoUpdate=r.spatialAutoUpdate),typeof r.spatialMinUpdateTime==`number`&&(this._spatialMinUpdateTime=r.spatialMinUpdateTime),this._subGraph=new e._SubGraph(this)}async _initAsync(e){e.outBus?this.outBus=e.outBus:(await this.engine.isReadyPromise,this.outBus=this.engine.defaultMainBus),await this._subGraph.initAsync(e),i(e)&&this._initSpatialProperty(),this.engine._addNode(this)}dispose(){super.dispose(),this._spatial=null,this._stereo=null,this.engine._removeNode(this)}get _inNode(){return this._subGraph._inNode}get _outNode(){return this._subGraph._outNode}get spatial(){return this._spatial?this._spatial:this._initSpatialProperty()}get stereo(){return this._stereo??=new r(this._subGraph)}getClassName(){return`_WebAudioBus`}_connect(e){let t=super._connect(e);return t?(e._inNode&&this._outNode?.connect(e._inNode),!0):!1}_disconnect(e){let t=super._disconnect(e);return t?(e._inNode&&this._outNode?.disconnect(e._inNode),!0):!1}_initSpatialProperty(){return this._spatial||=new t(this._subGraph,this._spatialAutoUpdate,this._spatialMinUpdateTime),this._spatial}};o._SubGraph=class extends n{get _downstreamNodes(){return this._owner._downstreamNodes??null}get _upstreamNodes(){return this._owner._upstreamNodes??null}};export{o as b};