import{f as e}from"./math.scalar.functions-DzEGaKm0.js";function t(e){return e.split(` `).filter(e=>e!==``).map(e=>parseFloat(e))}function n(e,n,r){for(;r.length!==n;){let n=t(e.lines[e.index++]);r.push(...n)}}function r(t,n,r){let i=0,a=0,o=0,s=0,c=0,l=0;for(let e=0;e<t.numberOfHorizontalAngles-1;e++)if(r<t.horizontalAngles[e+1]||e===t.numberOfHorizontalAngles-2){a=e,o=t.horizontalAngles[e],s=t.horizontalAngles[e+1];break}for(let e=0;e<t.numberOfVerticalAngles-1;e++)if(n<t.verticalAngles[e+1]||e===t.numberOfVerticalAngles-2){i=e,c=t.verticalAngles[e],l=t.verticalAngles[e+1];break}let u=s-o,d=l-c;if(d===0)return 0;let f=u===0?0:(r-o)/u,p=(n-c)/d,m=u===0?a:a+1,h=e(t.candelaValues[a][i],t.candelaValues[m][i],f),g=e(t.candelaValues[a][i+1],t.candelaValues[m][i+1],f),_=e(h,g,p);return _}function i(e){let i=new TextDecoder(`utf-8`),a=i.decode(e),o={lines:a.split(`
`),index:0},s={version:o.lines[0],candelaValues:[],horizontalAngles:[],verticalAngles:[],numberOfHorizontalAngles:0,numberOfVerticalAngles:0};for(o.index=1;o.lines.length>0&&!o.lines[o.index].includes(`TILT=`);)o.index++;o.lines[o.index].includes(`INCLUDE`),o.index++;let c=t(o.lines[o.index++]);s.numberOfLights=c[0],s.lumensPerLamp=c[1],s.candelaMultiplier=c[2],s.numberOfVerticalAngles=c[3],s.numberOfHorizontalAngles=c[4],s.photometricType=c[5],s.unitsType=c[6],s.width=c[7],s.length=c[8],s.height=c[9];let l=t(o.lines[o.index++]);s.ballastFactor=l[0],s.fileGenerationType=l[1],s.inputWatts=l[2];for(let e=0;e<s.numberOfHorizontalAngles;e++)s.candelaValues[e]=[];n(o,s.numberOfVerticalAngles,s.verticalAngles),n(o,s.numberOfHorizontalAngles,s.horizontalAngles);for(let e=0;e<s.numberOfHorizontalAngles;e++)n(o,s.numberOfVerticalAngles,s.candelaValues[e]);let u=-1;for(let e=0;e<s.numberOfHorizontalAngles;e++)for(let t=0;t<s.numberOfVerticalAngles;t++)s.candelaValues[e][t]*=s.candelaValues[e][t]*s.candelaMultiplier*s.ballastFactor*s.fileGenerationType,u=Math.max(u,s.candelaValues[e][t]);if(u>0)for(let e=0;e<s.numberOfHorizontalAngles;e++)for(let t=0;t<s.numberOfVerticalAngles;t++)s.candelaValues[e][t]/=u;let d=180,f=d*2,p=f*d,m=new Float32Array(f*d),h=s.horizontalAngles[0],g=s.horizontalAngles[s.numberOfHorizontalAngles-1];for(let e=0;e<p;e++){let t=e%f,n=Math.floor(e/f);g-h!==0&&(t<h||t>=g)&&(t%=g*2,t>g&&(t=g*2-t)),m[n+t*d]=r(s,n,t)}return{width:f/2,height:1,data:m}}var a=class{constructor(){this.supportCascades=!1}loadCubeData(){throw`.ies not supported in Cube.`}loadData(e,t,n){let r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=i(r);n(a.width,a.height,t.useMipMaps,!1,()=>{let e=t.getEngine();t.type=1,t.format=6,t._gammaSpace=!1,e._uploadDataToTextureDirectly(t,a.data)})}};export{a as b};