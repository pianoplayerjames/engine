const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iesTextureLoader-Bs3Z4jf9.js","assets/iesTextureLoader-BGpdRz0i.js","assets/math.scalar.functions-DzEGaKm0.js","assets/rolldown-runtime-9SXAGcFL.js","assets/ddsTextureLoader-C_dyr4ma.js","assets/effectRenderer-Byjm_Yfr.js","assets/index-BSOJ-fS9.js","assets/vendor-BdWBIe4_.js","assets/index-27V22rMo.css","assets/dataBuffer-BEUz_e_e.js","assets/logger-D2dXBhXY.js","assets/observable-8SYwW91n.js","assets/texture-DsComtb9.js","assets/engineStore-ChlzyWX_.js","assets/math.vector-Z6V1-M8S.js","assets/typeStore-CBdYsNuw.js","assets/guid-yfrujmXZ.js","assets/precisionDate-CPBgBNTn.js","assets/textureTools-Dk6qLkw3.js","assets/thinEngine-BctTIz6g.js","assets/dds-CGdJIt-z.js","assets/shaderStore-e8RCqiF-.js","assets/ddsTextureLoader-C07RHT-C.js","assets/postprocess.vertex-CeYFzkdl.js","assets/basisTextureLoader-CmKH5Lh5.js","assets/basisTextureLoader-ZNm24y57.js","assets/tools-BmEJizBm.js","assets/envTextureLoader-DuZ_VzvB.js","assets/envTextureLoader-Mk9dUhbS.js","assets/dumpTools-BfhiBjbq.js","assets/hdrTextureLoader-B3k-5JfX.js","assets/hdrTextureLoader-C5lgo7k8.js","assets/ktxTextureLoader-BtADH-zV.js","assets/ktxTextureLoader-DFzxfU_p.js","assets/tgaTextureLoader-C_wOL0Z0.js","assets/tgaTextureLoader-BCiYPMzd.js","assets/exrTextureLoader-DKPZgAlo.js","assets/exrTextureLoader-DWkFrMNm.js"])))=>i.map(i=>d[i]);
import{b as e}from"./index-BSOJ-fS9.js";import{c as t}from"./observable-8SYwW91n.js";import{b as n}from"./logger-D2dXBhXY.js";import{b as r,c as i}from"./engineStore-ChlzyWX_.js";import{b as a,c as o,d as s,e as c,f as l}from"./precisionDate-CPBgBNTn.js";import{b as u}from"./shaderStore-e8RCqiF-.js";const d={};function f(e,t=!1){if(!(t&&d[e]))return d[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}const p=`attribute`,m=`varying`;var h=class{constructor(){this.children=[]}isValid(e){return!0}process(e,t,n){let r=``;if(this.line){let n=this.line,i=t.processor;if(i){i.lineProcessor&&(n=i.lineProcessor(n,t.isFragment,t.processingContext));let r=t.processor?.attributeKeywordName??p,a=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:m;if(!t.isFragment&&i.attributeProcessor&&this.line.startsWith(r))n=i.attributeProcessor(this.line,e,t.processingContext);else if(i.varyingProcessor&&(i.varyingCheck?.(this.line,t.isFragment)||!i.varyingCheck&&this.line.startsWith(a)))n=i.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line))n=i.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith(`uniform`)&&!t.lookForClosingBracketForUniformBuffer){let r=/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/;r.test(this.line)?i.uniformProcessor&&(n=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&(n=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&this.line.indexOf(`}`)!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(n=i.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}r+=n+`
`}for(let i of this.children)r+=i.process(e,t,n);return this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||`true`,n[this.additionalDefineKey]=e[this.additionalDefineKey]),r}},g=class{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(let t of e){if(!t||t===`\r`)continue;if(t[0]===`#`){this._lines.push(t);continue}let e=t.trim();if(!e)continue;if(e.startsWith(`//`)){this._lines.push(t);continue}let n=e.indexOf(`;`);if(n===-1)this._lines.push(e);else if(n===e.length-1)e.length>1&&this._lines.push(e);else{let e=t.split(`;`);for(let t=0;t<e.length;t++){let n=e[t];n&&(n=n.trim(),n&&this._lines.push(n+(t===e.length-1?``:`;`)))}}}}},_=class extends h{process(e,t,n){for(let r=0;r<this.children.length;r++){let i=this.children[r];if(i.isValid(e))return i.process(e,t,n)}return``}},v=class extends h{isValid(e){return this.testExpression.isTrue(e)}},y=class e{isTrue(e){return!0}static postfixToInfix(t){let n=[];for(let r of t)if(e._OperatorPriority[r]===void 0)n.push(r);else{let e=n[n.length-1],t=n[n.length-2];n.length-=2,n.push(`(${t}${r}${e})`)}return n[n.length-1]}static infixToPostfix(t){let n=e._InfixToPostfixCache.get(t);if(n)return n.accessTime=Date.now(),n.result;if(!t.includes(`&&`)&&!t.includes(`||`)&&!t.includes(`)`)&&!t.includes(`(`))return[t];let r=[],i=-1,a=()=>{u=u.trim(),u!==``&&(r.push(u),u=``)},o=t=>{i<e._Stack.length-1&&(e._Stack[++i]=t)},s=()=>e._Stack[i],c=()=>i===-1?`!!INVALID EXPRESSION!!`:e._Stack[i--],l=0,u=``;for(;l<t.length;){let n=t.charAt(l),d=l<t.length-1?t.substring(l,2+l):``;if(n===`(`)u=``,o(n);else if(n===`)`){for(a();i!==-1&&s()!==`(`;)r.push(c());c()}else if(e._OperatorPriority[d]>1){for(a();i!==-1&&e._OperatorPriority[s()]>=e._OperatorPriority[d];)r.push(c());o(d),l++}else u+=n;l++}for(a();i!==-1;)s()===`(`?c():r.push(c());return e._InfixToPostfixCache.size>=e.InfixToPostfixCacheLimitSize&&e.ClearCache(),e._InfixToPostfixCache.set(t,{result:r,accessTime:Date.now()}),r}static ClearCache(){let t=Array.from(e._InfixToPostfixCache.entries()).sort((e,t)=>e[1].accessTime-t[1].accessTime);for(let n=0;n<e.InfixToPostfixCacheCleanupSize;n++)e._InfixToPostfixCache.delete(t[n][0])}};y.InfixToPostfixCacheLimitSize=5e4,y.InfixToPostfixCacheCleanupSize=25e3,y._InfixToPostfixCache=new Map,y._OperatorPriority={")":0,"(":1,"||":2,"&&":3},y._Stack=[``,``,``,``,``,``,``,``,``,``,``,``,``,``,``,``,``,``,``,``];var b=class extends y{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=e[this.define]!==void 0;return this.not&&(t=!t),t}},x=class extends y{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}},S=class extends y{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}},C=class extends y{constructor(e,t,n){super(),this.define=e,this.operand=t,this.testValue=n}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(e){let t=!1,n=parseInt(e[this.define]==null?this.define:e[this.define]),r=parseInt(e[this.testValue]==null?this.testValue:e[this.testValue]);if(isNaN(n)||isNaN(r))return!1;switch(this.operand){case`>`:t=n>r;break;case`<`:t=n<r;break;case`<=`:t=n<=r;break;case`>=`:t=n>=r;break;case`==`:t=n===r;break;case`!=`:t=n!==r;break}return t}};const w={};function T(e,t,n=``){return n+(t?t+`
`:``)+e}function E(e,t,n,r,i,a,o){let s=o||w.loadFile;if(s){let o=s(e,t,n,r,i,a);return o}throw f(`FileTools`)}function D(e,t,n,r){if(e){t?e.IS_NDC_HALF_ZRANGE=``:delete e.IS_NDC_HALF_ZRANGE,n?e.USE_REVERSE_DEPTHBUFFER=``:delete e.USE_REVERSE_DEPTHBUFFER,r?e.USE_EXACT_SRGB_CONVERSIONS=``:delete e.USE_EXACT_SRGB_CONVERSIONS;return}else{let e=``;return t&&(e+=`#define IS_NDC_HALF_ZRANGE`),n&&(e&&(e+=`
`),e+=`#define USE_REVERSE_DEPTHBUFFER`),r&&(e&&(e+=`
`),e+=`#define USE_EXACT_SRGB_CONVERSIONS`),e}}function O(e,t,n=!1,r){switch(e){case 3:{let e=(t instanceof ArrayBuffer,new Int8Array(t));return r&&e.set(new Int8Array(r)),e}case 0:{let e=(t instanceof ArrayBuffer,new Uint8Array(t));return r&&e.set(new Uint8Array(r)),e}case 4:{let e=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&e.set(new Int16Array(r)),e}case 5:case 8:case 9:case 10:case 2:{let e=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&e.set(new Uint16Array(r)),e}case 6:{let e=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&e.set(new Int32Array(r)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&e.set(new Uint32Array(r)),e}case 1:{let e=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&e.set(new Float32Array(r)),e}}let i=(t instanceof ArrayBuffer,new Uint8Array(t));return r&&i.set(new Uint8Array(r)),i}const k=/defined\s*?\((.+?)\)/g,A=/defined\s*?\[(.+?)\]/g,ee=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,te=/__decl__/,ne=/light\{X\}.(\w*)/g,re=/\{X\}/g,j=[],ie=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function M(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function N(e,t,n,r){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),R(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?`fragment`:`vertex`,e,t.defines));let i=de(e,t,r);n(i,e)})}function ae(e,t,n,r){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),R(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?`fragment`:`vertex`,e,t.defines));let i=fe(e,t,r);n(i,e)})}function oe(e,t,n){return!n.processor||!n.processor.finalizeShaders?{vertexCode:e,fragmentCode:t}:n.processor.finalizeShaders(e,t,n.processingContext)}function se(e,t){if(t.processor?.noPrecision)return e;let n=t.shouldUseHighPrecisionShader;return e.indexOf(`precision highp float`)===-1?e=n?`precision highp float;
`+e:`precision mediump float;
`+e:n||(e=e.replace(`precision highp float`,`precision mediump float`)),e}function P(e){let t=/defined\((.+)\)/,n=t.exec(e);if(n&&n.length)return new b(n[1].trim(),e[0]===`!`);let r=[`==`,`!=`,`>=`,`<=`,`<`,`>`],i=``,a=0;for(i of r)if(a=e.indexOf(i),a>-1)break;if(a===-1)return new b(e);let o=e.substring(0,a).trim(),s=e.substring(a+i.length).trim();return new C(o,i,s)}function ce(e){e=e.replace(k,`defined[$1]`);let t=y.infixToPostfix(e),n=[];for(let e of t)if(e!==`||`&&e!==`&&`)n.push(e);else if(n.length>=2){let t=n[n.length-1],r=n[n.length-2];n.length-=2;let i=e==`&&`?new S:new x;typeof t==`string`&&(t=t.replace(A,`defined($1)`)),typeof r==`string`&&(r=r.replace(A,`defined($1)`)),i.leftOperand=typeof r==`string`?P(r):r,i.rightOperand=typeof t==`string`?P(t):t,n.push(i)}let r=n[n.length-1];return typeof r==`string`&&(r=r.replace(A,`defined($1)`)),typeof r==`string`?P(r):r}function F(e,t){let n=new v,r=e.substring(0,t),i=e.substring(t);return i=i.substring(0,(i.indexOf(`//`)+1||i.length+1)-1).trim(),r===`#ifdef`?n.testExpression=new b(i):r===`#ifndef`?n.testExpression=new b(i,!0):n.testExpression=ce(i),n}function I(e,t,n,r){let i=e.currentLine;for(;L(e,n,r);){i=e.currentLine;let a=i.substring(0,5).toLowerCase();if(a===`#else`){let n=new h;t.children.push(n),L(e,n,r);return}else if(a===`#elif`){let e=F(i,5);t.children.push(e),n=e}}}function L(e,t,n){for(;e.canRead;){e.lineIndex++;let r=e.currentLine;if(r.indexOf(`#`)>=0){let i=ie.exec(r);if(i&&i.length){let a=i[0];switch(a){case`#ifdef`:{let i=new _;t.children.push(i);let a=F(r,6);i.children.push(a),I(e,i,a,n);break}case`#else`:case`#elif`:return!0;case`#endif`:return!1;case`#ifndef`:{let i=new _;t.children.push(i);let a=F(r,7);i.children.push(a),I(e,i,a,n);break}case`#if`:{let i=new _,a=F(r,3);t.children.push(i),i.children.push(a),I(e,i,a,n);break}}continue}}let i=new h;if(i.line=r,t.children.push(i),r[0]===`#`&&r[1]===`d`){let e=r.replace(`;`,``).split(` `);i.additionalDefineKey=e[1],e.length===3&&(i.additionalDefineValue=e[2])}}return!1}function le(e,t,n,r){let i=new h,a=new g;return a.lineIndex=-1,a.lines=e.split(`
`),L(a,i,r),i.process(t,n,r)}function ue(e,t){let n=e.defines,r={};for(let e of n){let t=e.replace(`#define`,``).replace(`;`,``).trim(),n=t.split(` `);r[n[0]]=n.length>1?n[1]:``}return e.processor?.shaderLanguage===0&&(r.GL_ES=`true`),r.__VERSION__=e.version,r[e.platformName]=`true`,D(r,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),r}function de(e,t,n){let r=se(e,t);if(!t.processor||t.processor.shaderLanguage===0&&r.indexOf(`#version 3`)!==-1&&(r=r.replace(`#version 300 es`,``),!t.processor.parseGLES3))return r;let i=t.defines,a=ue(t,n);t.processor.preProcessor&&(r=t.processor.preProcessor(r,i,a,t.isFragment,t.processingContext));let o={};return r=le(r,a,t,o),t.processor.postProcessor&&(r=t.processor.postProcessor(r,i,t.isFragment,t.processingContext,n?{drawBuffersExtensionDisabled:!n.getCaps().drawBuffersExtension}:{},a,o)),n?._features.needShaderCodeInlining&&(r=n.inlineShaderCode(r)),r}function fe(e,t,n){let r=e,i=t.defines,a=ue(t,n);t.processor?.preProcessor&&(r=t.processor.preProcessor(r,i,a,t.isFragment,t.processingContext));let o={};return r=le(r,a,t,o),t.processor?.postProcessor&&(r=t.processor.postProcessor(r,i,t.isFragment,t.processingContext,n?{drawBuffersExtensionDisabled:!n.getCaps().drawBuffersExtension}:{},a,o)),n._features.needShaderCodeInlining&&(r=n.inlineShaderCode(r)),r}function R(e,t,n){j.length=0;let r;for(;(r=ee.exec(e))!==null;)j.push(r);let i=String(e),a=[e],o=!1;for(let e of j){let r=e[1];if(r.indexOf(`__decl__`)!==-1&&(r=r.replace(te,``),t.supportsUniformBuffers&&(r=r.replace(`Vertex`,`Ubo`).replace(`Fragment`,`Ubo`)),r+=`Declaration`),t.includesShadersStore[r]){let n=t.includesShadersStore[r];if(e[2]){let t=e[3].split(`,`);for(let e=0;e<t.length;e+=2){let r=new RegExp(t[e],`g`),i=t[e+1];n=n.replace(r,i)}}if(e[4]){let r=e[5];if(r.indexOf(`..`)!==-1){let e=r.split(`..`),i=parseInt(e[0]),a=parseInt(e[1]),o=n.slice(0);n=``,isNaN(a)&&(a=t.indexParameters[e[1]]);for(let e=i;e<a;e++)t.supportsUniformBuffers||(o=o.replace(ne,(e,t)=>t+`{X}`)),n+=o.replace(re,e.toString())+`
`}else t.supportsUniformBuffers||(n=n.replace(ne,(e,t)=>t+`{X}`)),n=n.replace(re,r)}let i=[];for(let t of a){let r=t.split(e[0]);for(let e=0;e<r.length-1;e++)i.push(r[e]),i.push(n);i.push(r[r.length-1])}a=i,o=o||n.indexOf(`#include<`)>=0||n.indexOf(`#include <`)>=0}else{let e=t.shadersRepository+`ShadersInclude/`+r+`.fx`;pe.loadFile(e,e=>{t.includesShadersStore[r]=e,R(a.join(``),t,n)});return}}j.length=0,i=a.join(``),o?R(i.toString(),t,n):n(i)}const pe={loadFile:(e,t,n,r,i,a)=>{throw f(`FileTools`)}};let z=[];var me=class{static SetImmediate(e){z.length===0&&setTimeout(()=>{let e=z;z=[];for(let t of e)t()},1),z.push(e)}};function B(e,t,n){try{if(e())return t(),!0}catch(e){return n?.(e),!0}return!1}const he=(e,t,n,r=16,i=3e4,a=!0,o)=>{if(a&&B(e,t,n))return null;let s=setInterval(()=>{B(e,t,n)?clearInterval(s):(i-=r,i<0&&(clearInterval(s),n?.(Error(`Operation timed out after maximum retries. `+(o||``)),!0)))},r);return()=>clearInterval(s)};var ge=class{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,n,r,i,a,o,s){let c=this.engine;if(c.supportsUniformBuffers)for(let n in t)e.bindUniformBlock(n,t[n]);let l=this.engine.getUniforms(this,n);l.forEach((e,t)=>{r[n[t]]=e}),this._uniforms=r;let u;for(u=0;u<i.length;u++){let t=e.getUniform(i[u]);t??(i.splice(u,1),u--)}i.forEach((e,t)=>{a[e]=t});for(let e of c.getAttributes(this,o))s.push(e)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){let n=this._valueCache[e],r=t.updateFlag;return n!==void 0&&n===r?!1:(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,n){let r=this._valueCache[e];if(!r||r.length!==2)return r=[t,n],this._valueCache[e]=r,!0;let i=!1;return r[0]!==t&&(r[0]=t,i=!0),r[1]!==n&&(r[1]=n,i=!0),i}_cacheFloat3(e,t,n,r){let i=this._valueCache[e];if(!i||i.length!==3)return i=[t,n,r],this._valueCache[e]=i,!0;let a=!1;return i[0]!==t&&(i[0]=t,a=!0),i[1]!==n&&(i[1]=n,a=!0),i[2]!==r&&(i[2]=r,a=!0),a}_cacheFloat4(e,t,n,r,i){let a=this._valueCache[e];if(!a||a.length!==4)return a=[t,n,r,i],this._valueCache[e]=a,!0;let o=!1;return a[0]!==t&&(a[0]=t,o=!0),a[1]!==n&&(a[1]=n,o=!0),a[2]!==r&&(a[2]=r,o=!0),a[3]!==i&&(a[3]=i,o=!0),o}setInt(e,t){let n=this._valueCache[e];n!==void 0&&n===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,n){this._cacheFloat2(e,t,n)&&(this.engine.setInt2(this._uniforms[e],t,n)||(this._valueCache[e]=null))}setInt3(e,t,n,r){this._cacheFloat3(e,t,n,r)&&(this.engine.setInt3(this._uniforms[e],t,n,r)||(this._valueCache[e]=null))}setInt4(e,t,n,r,i){this._cacheFloat4(e,t,n,r,i)&&(this.engine.setInt4(this._uniforms[e],t,n,r,i)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){let n=this._valueCache[e];n!==void 0&&n===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,n){this._cacheFloat2(e,t,n)&&(this.engine.setUInt2(this._uniforms[e],t,n)||(this._valueCache[e]=null))}setUInt3(e,t,n,r){this._cacheFloat3(e,t,n,r)&&(this.engine.setUInt3(this._uniforms[e],t,n,r)||(this._valueCache[e]=null))}setUInt4(e,t,n,r,i){this._cacheFloat4(e,t,n,r,i)&&(this.engine.setUInt4(this._uniforms[e],t,n,r,i)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){let n=this._valueCache[e];n!==void 0&&n===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,n){this._cacheFloat2(e,t,n)&&(this.engine.setFloat2(this._uniforms[e],t,n)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,n,r){this._cacheFloat3(e,t,n,r)&&(this.engine.setFloat3(this._uniforms[e],t,n,r)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,n,r,i){this._cacheFloat4(e,t,n,r,i)&&(this.engine.setFloat4(this._uniforms[e],t,n,r,i)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,n){this._cacheFloat4(e,t.r,t.g,t.b,n)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,n)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}};const V=new WeakMap,_e={_webGLVersion:2,cachedPipelines:{}};function H(e){let t=V.get(e);if(!t){if(!e)return _e;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,parallelShaderCompile:e.getExtension(`KHR_parallel_shader_compile`)||void 0,cachedPipelines:{}},V.set(e,t)}return t}function ve(e){V.delete(e)}function ye(e,t,n,r,i,a){let o=H(r);a||=o._createShaderProgramInjection??U;let s=G(t,`vertex`,r,o._contextWasLost),c=G(n,`fragment`,r,o._contextWasLost);return a(e,s,c,r,i,o.validateShaderPrograms)}function be(e,t,n,r,i,a=null,o){let s=H(i);o||=s._createShaderProgramInjection??U;let c=s._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:``,l=we(t,`vertex`,r,c,i,s._contextWasLost),u=we(n,`fragment`,r,c,i,s._contextWasLost);return o(e,l,u,i,a,s.validateShaderPrograms)}function xe(e,t){let n=new ge,r=H(e);return r.parallelShaderCompile&&!r.disableParallelShaderCompile&&(n.isParallelCompiled=!0),n.context=r._context,n}function U(e,t,n,r,i=null,a){let o=r.createProgram();if(e.program=o,!o)throw Error(`Unable to create program`);return r.attachShader(o,t),r.attachShader(o,n),r.linkProgram(o),e.context=r,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||W(e,r,a),o}function Se(e,t,n){let r=e;if(r._isDisposed)return!1;let i=H(t);return i&&i.parallelShaderCompile&&i.parallelShaderCompile.COMPLETION_STATUS_KHR&&r.program&&t.getProgramParameter(r.program,i.parallelShaderCompile.COMPLETION_STATUS_KHR)?(W(r,t,n),!0):!1}function W(e,t,n){let r=e.context,i=e.vertexShader,a=e.fragmentShader,o=e.program,s=r.getProgramParameter(o,r.LINK_STATUS);if(!s){if(!t.getShaderParameter(i,t.COMPILE_STATUS)){let n=t.getShaderInfoLog(i);if(n)throw e.vertexCompilationError=n,Error(`VERTEX SHADER `+n)}if(!t.getShaderParameter(a,t.COMPILE_STATUS)){let n=t.getShaderInfoLog(a);if(n)throw e.fragmentCompilationError=n,Error(`FRAGMENT SHADER `+n)}let n=r.getProgramInfoLog(o);if(n)throw e.programLinkError=n,Error(n)}if(n){r.validateProgram(o);let t=r.getProgramParameter(o,r.VALIDATE_STATUS);if(!t){let t=r.getProgramInfoLog(o);if(t)throw e.programValidationError=t,Error(t)}}r.deleteShader(i),r.deleteShader(a),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function Ce(e,t,n,r,i,a,o,s,c,l=``,u,d,f){let p=H(e.context);d||=p.createRawShaderProgramInjection??ye,f||=p.createShaderProgramInjection??be;let m=e;r?m.program=d(m,t,n,m.context,c):m.program=f(m,t,n,s,m.context,c),m.program.__SPECTOR_rebuildProgram=o,u()}function we(e,t,n,r,i,a){return G(T(e,n,r),t,i,a)}function G(e,t,n,r){let i=n.createShader(t===`vertex`?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(!i){let e=n.NO_ERROR,i=n.NO_ERROR;for(;(i=n.getError())!==n.NO_ERROR;)e=i;throw Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${n.isContextLost()}, _contextWasLost=${r}`)}return n.shaderSource(i,e),n.compileShader(i),i}function Te(e,t){t.useProgram(e)}function Ee(e,t){let n=e;if(!n.isParallelCompiled){t(e);return}let r=n.onCompiled;n.onCompiled=()=>{r?.(),t(e)}}function De(e,t){let n=H(t);return n.cachedPipelines[e]}function Oe(e){let t=e._name,n=e.context;if(t&&n){let e=H(n),r=e.cachedPipelines[t];r?.dispose(),delete e.cachedPipelines[t]}}function ke(e,t,n,r,i,a,o){let s,c,u=l()?a?.getHostDocument():null;s=typeof t==`string`?t:t.vertexSource?`source:`+t.vertexSource:t.vertexElement?u?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,c=typeof t==`string`?t:t.fragmentSource?`source:`+t.fragmentSource:t.fragmentElement?u?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;let d=[void 0,void 0],f=()=>{if(d[0]&&d[1]){e.isFragment=!0;let[s,c]=d;N(c,e,(a,c)=>{o&&(o._fragmentSourceCodeBeforeMigration=c),n&&(a=n(`fragment`,a));let l=oe(s,a,e);e=null;let u=je(l.vertexCode,l.fragmentCode,t,i);r?.(u.vertexSourceCode,u.fragmentSourceCode)},a)}};Ae(s,`Vertex`,``,t=>{M(e),N(t,e,(e,r)=>{o&&(o._rawVertexSourceCode=t,o._vertexSourceCodeBeforeMigration=r),n&&(e=n(`vertex`,e)),d[0]=e,f()},a)},i),Ae(c,`Fragment`,`Pixel`,e=>{o&&(o._rawFragmentSourceCode=e),d[1]=e,f()},i)}function Ae(e,t,n,r,i,a){if(typeof HTMLElement<`u`&&e instanceof HTMLElement){let t=o(e);r(t);return}if(e.substring(0,7)===`source:`){r(e.substring(7));return}if(e.substring(0,7)===`base64:`){let t=window.atob(e.substring(7));r(t);return}let s=u.GetShadersStore(i);if(s[e+t+`Shader`]){r(s[e+t+`Shader`]);return}if(n&&s[e+n+`Shader`]){r(s[e+n+`Shader`]);return}let c;if(c=e[0]===`.`||e[0]===`/`||e.indexOf(`http`)>-1?e:u.GetShadersRepository(i)+e,a||=E,!a)throw Error(`loadFileInjection is not defined`);a(c+`.`+t.toLowerCase()+`.fx`,r)}function je(e,t,n,r){if(n){let i=n.vertexElement||n.vertex||n.spectorName||n,a=n.fragmentElement||n.fragment||n.spectorName||n;return{vertexSourceCode:(r===1?`//`:``)+`#define SHADER_NAME vertex:`+i+`
`+e,fragmentSourceCode:(r===1?`//`:``)+`#define SHADER_NAME fragment:`+a+`
`+t}}else return{vertexSourceCode:e,fragmentSourceCode:t}}const Me=(e,t,r,i)=>{try{let n=e.context?H(e.context):null;n&&(n.disableParallelShaderCompile=e.disableParallelCompilation);let a=e.existingPipelineContext||t(e.shaderProcessingContext);return a._name=e.name,e.name&&n&&(n.cachedPipelines[e.name]=a),r(a,e.vertex,e.fragment,!!e.createAsRaw,``,``,e.rebuildRebind,e.defines,e.transformFeedbackVaryings,``,()=>{i(a,()=>{e.onRenderingStateCompiled?.(a)})}),a}catch(e){throw n.Error(`Error compiling effect`),e}};var K=class e{static get ShadersRepository(){return u.ShadersRepository}static set ShadersRepository(e){u.ShadersRepository=e}get isDisposed(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||=new t,this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(n,r,i,a=null,o,s=null,c=null,l=null,u=null,d,f=``,p=0,m){this.defines=``,this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new t,this.onErrorObservable=new t,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError=``,this._allFallbacksProcessed=!1,this._uniforms={},this._key=``,this._fallbacks=null,this._vertexSourceCodeOverride=``,this._fragmentSourceCodeOverride=``,this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode=``,this._fragmentSourceCode=``,this._vertexSourceCodeBeforeMigration=``,this._fragmentSourceCodeBeforeMigration=``,this._rawVertexSourceCode=``,this._rawFragmentSourceCode=``,this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=n,this._key=f;let h=this._key.replace(/\r/g,``).replace(/\n/g,`|`),g;if(r.attributes){let e=r;if(this._engine=i,this._attributesNames=e.attributes,this._uniformsNames=e.uniformsNames.concat(e.samplers),this._samplerList=e.samplers.slice(),this.defines=e.defines,this.onError=e.onError,this.onCompiled=e.onCompiled,this._fallbacks=e.fallbacks,this._indexParameters=e.indexParameters,this._transformFeedbackVaryings=e.transformFeedbackVaryings||null,this._multiTarget=!!e.multiTarget,this._shaderLanguage=e.shaderLanguage??0,this._disableParallelShaderCompilation=!!e.disableParallelShaderCompilation,e.uniformBuffersNames){this._uniformBuffersNamesList=e.uniformBuffersNames.slice();for(let t=0;t<e.uniformBuffersNames.length;t++)this._uniformBuffersNames[e.uniformBuffersNames[t]]=t}this._processFinalCode=e.processFinalCode??null,this._processCodeAfterIncludes=e.processCodeAfterIncludes??void 0,m=e.extraInitializationsAsync,g=e.existingPipelineContext}else this._engine=o,this.defines=s??``,this._uniformsNames=i.concat(a),this._samplerList=a?a.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this._shaderLanguage=p,this.onError=u,this.onCompiled=l,this._indexParameters=d,this._fallbacks=c;this._engine.shaderPlatformName===`WEBGL2`&&(g=De(h,this._engine._gl)??g),this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++,g?(this._pipelineContext=g,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,m),this._engine.onReleaseEffectsObservable.addOnce(()=>{this.isDisposed||this.dispose(!0)})}async _processShaderCodeAsync(e=null,t=!1,n=null,r){r&&await r(),this._processingContext=n||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);let i={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:u.GetShadersRepository(this._shaderLanguage),includesShadersStore:u.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};ke(i,this.name,this._processFinalCode,(e,n)=>{this._vertexSourceCode=e,this._fragmentSourceCode=n,this._prepareEffect(t)},this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return this._engine.isDisposed||this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise(e=>{this.executeWhenCompiled(e)})}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&this._checkIsReady(null)}_checkIsReady(e){he(()=>this._isReadyInternal()||this._isDisposed,()=>{},t=>{this._processCompilationErrors(t,e)},16,12e4,!0,` - Effect: ${typeof this.name==`string`?this.name:this.key}`)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split(`
`),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,n,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{r&&r(t)},this.onCompiled=()=>{let e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(127);this._pipelineContext._handlesSpectorRebuildCallback?.(n)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(t){if(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){let t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError=``,this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),e.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(e=!1){let t=this._pipelineContext;this._isReady=!1;try{let n=!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride),r=n?null:this.defines,i=n?this._vertexSourceCodeOverride:this._vertexSourceCode,a=n?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=Me({existingPipelineContext:e?t:null,vertex:i,fragment:a,context:o.shaderPlatformName===`WEBGL2`||o.shaderPlatformName===`WEBGL1`?o._gl:void 0,rebuildRebind:(e,t,n,r)=>this._rebuildProgram(e,t,n,r),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,``).replace(/\n/g,`|`),createAsRaw:n,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:n=>{t&&!e&&this._engine._deletePipelineContext(t),n&&this._onRenderingStateCompiled(n)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}_getShaderCodeAndErrorLine(e,t,n){let r=n?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,i=null;if(t&&e){let a=t.match(r);if(a&&a.length===2){let t=parseInt(a[1]),r=e.split(`
`,-1);r.length>=t&&(i=`Offending line [${t}] in ${n?`fragment`:`vertex`} code: ${r[t-1]}`)}}return[e,i]}_processCompilationErrors(t,r=null){this._compilationError=t.message;let i=this._attributesNames,a=this._fallbacks;if(n.Error(`Unable to compile effect:`),n.Error(`Uniforms: ${this._uniformsNames.join(` `)}`),n.Error(`Attributes: ${i.join(` `)}`),n.Error(`Defines:
`+this.defines),e.LogShaderCodeOnCompilationError){let e=null,t=null,r=null;this._pipelineContext?._getVertexShaderCode()&&([r,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),r&&(n.Error(`Vertex code:`),n.Error(r))),this._pipelineContext?._getFragmentShaderCode()&&([r,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),r&&(n.Error(`Fragment code:`),n.Error(r))),e&&n.Error(e),t&&n.Error(t)}n.Error(`Error: `+this._compilationError);let o=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};r&&(this._pipelineContext=r,this._isReady=!0,o()),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,n.Error(`Trying next fallback.`),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,o(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,r||o())}get isSupported(){return this._compilationError===``}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){let n=e+`Ex`;if(this._samplerList.indexOf(n+`0`)===-1){let r=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){let t=n+(e-1).toString();this._samplerList.splice(r+e,0,t)}let i=0;for(let e of this._samplerList)this._samplers[e]=i,i+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(t,n){let r=this._uniformBuffersNames[n];r===void 0||e._BaseCache[r]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[r]=t,this._engine.bindUniformBufferBase(t,r,n))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,n){return this._pipelineContext.setInt2(e,t,n),this}setInt3(e,t,n,r){return this._pipelineContext.setInt3(e,t,n,r),this}setInt4(e,t,n,r,i){return this._pipelineContext.setInt4(e,t,n,r,i),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,n){return this._pipelineContext.setUInt2(e,t,n),this}setUInt3(e,t,n,r){return this._pipelineContext.setUInt3(e,t,n,r),this}setUInt4(e,t,n,r,i){return this._pipelineContext.setUInt4(e,t,n,r,i),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,n){return this._pipelineContext.setFloat2(e,t,n),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,n,r){return this._pipelineContext.setFloat3(e,t,n,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,n,r,i){return this._pipelineContext.setFloat4(e,t,n,r,i),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,n){return this._pipelineContext.setColor4(e,t,n),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}clearCodeCache(){this._vertexSourceCode=``,this._fragmentSourceCode=``,this._fragmentSourceCodeBeforeMigration=``,this._vertexSourceCodeBeforeMigration=``}dispose(t=!1){if(t)this._refCount=0;else{if(e.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&Oe(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(e,t,n,r=0){t&&(u.GetShadersStore(r)[`${e}PixelShader`]=t),n&&(u.GetShadersStore(r)[`${e}VertexShader`]=n)}static ResetCache(){e._BaseCache={}}};K.LogShaderCodeOnCompilationError=!0,K.PersistentMode=!1,K.AutomaticallyClearCodeCache=!1,K._UniqueIdSeed=0,K._BaseCache={},K.ShadersStore=u.ShadersStore,K.IncludesShadersStore=u.IncludesShadersStore;var Ne=class{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}},Pe=class{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get backFunc(){return this._func}set backFunc(e){this._backFunc!==e&&(this._backFunc=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get backOpStencilFail(){return this._backOpStencilFail}set backOpStencilFail(e){this._backOpStencilFail!==e&&(this._backOpStencilFail=e,this._isStencilOpDirty=!0)}get backOpDepthFail(){return this._backOpDepthFail}set backOpDepthFail(e){this._backOpDepthFail!==e&&(this._backOpDepthFail=e,this._isStencilOpDirty=!0)}get backOpStencilDepthPass(){return this._backOpStencilDepthPass}set backOpStencilDepthPass(e){this._backOpStencilDepthPass!==e&&(this._backOpStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;let t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.backFunc=t?this.stencilMaterial.backFunc:this.stencilGlobal.backFunc,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.backOpStencilFail=t?this.stencilMaterial.backOpStencilFail:this.stencilGlobal.backOpStencilFail,this.backOpDepthFail=t?this.stencilMaterial.backOpDepthFail:this.stencilGlobal.backOpDepthFail,this.backOpStencilDepthPass=t?this.stencilMaterial.backOpStencilDepthPass:this.stencilGlobal.backOpStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFuncSeparate(e.FRONT,this.func,this.funcRef,this.funcMask),e.stencilFuncSeparate(e.BACK,this.backFunc,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOpSeparate(e.FRONT,this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),e.stencilOpSeparate(e.BACK,this.backOpStencilFail,this.backOpDepthFail,this.backOpStencilDepthPass),this._isStencilOpDirty=!1))}},q=class e{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.funcRef=1,this.funcMask=255,this.func=e.ALWAYS,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE,this.backFunc=e.ALWAYS,this.backOpStencilFail=e.KEEP,this.backOpDepthFail=e.KEEP,this.backOpStencilDepthPass=e.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilBackFunc(){return this.backFunc}set stencilBackFunc(e){this.backFunc=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilBackOpStencilFail(){return this.backOpStencilFail}set stencilBackOpStencilFail(e){this.backOpStencilFail=e}get stencilBackOpDepthFail(){return this.backOpDepthFail}set stencilBackOpDepthFail(e){this.backOpDepthFail=e}get stencilBackOpStencilDepthPass(){return this.backOpStencilDepthPass}set stencilBackOpStencilDepthPass(e){this.backOpStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}};q.ALWAYS=519,q.KEEP=7680,q.REPLACE=7681;var Fe=class{constructor(){this._blendFunctionParameters=Array(32),this._blendEquationParameters=Array(16),this._blendConstants=[,,,,],this._isBlendConstantsDirty=!1,this._alphaBlend=Array(8).fill(!1),this._numTargetEnabled=0,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._numTargetEnabled>0}setAlphaBlend(e,t=0){this._alphaBlend[t]!==e&&(e?this._numTargetEnabled++:this._numTargetEnabled--,this._alphaBlend[t]=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,n,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===n&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=n,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,n,r,i=0){let a=i*4;this._blendFunctionParameters[a+0]===e&&this._blendFunctionParameters[a+1]===t&&this._blendFunctionParameters[a+2]===n&&this._blendFunctionParameters[a+3]===r||(this._blendFunctionParameters[a+0]=e,this._blendFunctionParameters[a+1]=t,this._blendFunctionParameters[a+2]=n,this._blendFunctionParameters[a+3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t,n=0){let r=n*2;this._blendEquationParameters[r+0]===e&&this._blendEquationParameters[r+1]===t||(this._blendEquationParameters[r+0]=e,this._blendEquationParameters[r+1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend.fill(!1),this._numTargetEnabled=0,this._blendFunctionParameters.fill(null),this._blendEquationParameters.fill(null),this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e,t=1){if(this.isDirty){if(this._isAlphaBlendDirty){if(t===1)this._alphaBlend[0]?e.enable(e.BLEND):e.disable(e.BLEND);else{let n=e;for(let r=0;r<t;r++){let t=r<this._numTargetEnabled?r:0;this._alphaBlend[t]?n.enableIndexed(e.BLEND,r):n.disableIndexed(e.BLEND,r)}}this._isAlphaBlendDirty=!1}if(this._isBlendFunctionParametersDirty){if(t===1)e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]);else{let n=e;for(let e=0;e<t;e++){let t=e<this._numTargetEnabled?e*4:0;n.blendFuncSeparateIndexed(e,this._blendFunctionParameters[t+0],this._blendFunctionParameters[t+1],this._blendFunctionParameters[t+2],this._blendFunctionParameters[t+3])}}this._isBlendFunctionParametersDirty=!1}if(this._isBlendEquationParametersDirty){if(t===1)e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]);else{let n=e;for(let e=0;e<t;e++){let t=e<this._numTargetEnabled?e*2:0;n.blendEquationSeparateIndexed(e,this._blendEquationParameters[t+0],this._blendEquationParameters[t+1])}}this._isBlendEquationParametersDirty=!1}this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1)}}setAlphaMode(e,t){let n=32774;switch(e){case 0:break;case 7:this.setAlphaBlendFunctionParameters(1,771,1,1,t);break;case 8:this.setAlphaBlendFunctionParameters(1,771,1,771,t);break;case 2:this.setAlphaBlendFunctionParameters(770,771,1,1,t);break;case 6:this.setAlphaBlendFunctionParameters(1,1,0,1,t);break;case 1:this.setAlphaBlendFunctionParameters(770,1,0,1,t);break;case 3:this.setAlphaBlendFunctionParameters(0,769,1,1,t),n=32778;break;case 4:this.setAlphaBlendFunctionParameters(774,0,1,1,t);break;case 5:this.setAlphaBlendFunctionParameters(770,769,1,1,t);break;case 9:this.setAlphaBlendFunctionParameters(32769,32770,32771,32772,t);break;case 10:this.setAlphaBlendFunctionParameters(1,769,1,771,t);break;case 11:this.setAlphaBlendFunctionParameters(1,1,1,1,t);break;case 12:this.setAlphaBlendFunctionParameters(772,1,0,0,t);break;case 13:this.setAlphaBlendFunctionParameters(775,769,773,771,t);break;case 14:this.setAlphaBlendFunctionParameters(1,771,1,771,t);break;case 15:this.setAlphaBlendFunctionParameters(1,1,1,0,t);break;case 16:this.setAlphaBlendFunctionParameters(775,769,0,1,t);break;case 17:this.setAlphaBlendFunctionParameters(770,771,1,771,t);break;case 18:this.setAlphaBlendFunctionParameters(1,1,1,1,t),n=32775;break;case 19:this.setAlphaBlendFunctionParameters(1,1,1,1,t),n=32776;break;case 20:this.setAlphaBlendFunctionParameters(1,35065,0,1,t);break}this.setAlphaEquationParameters(n,n,t)}},Ie=class{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,n=1,r=1,i=2,a=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=n,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=i,this._comparisonFunction=a,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}},Le;(function(e){e[e.Unknown=0]=`Unknown`,e[e.Url=1]=`Url`,e[e.Temp=2]=`Temp`,e[e.Raw=3]=`Raw`,e[e.Dynamic=4]=`Dynamic`,e[e.RenderTarget=5]=`RenderTarget`,e[e.MultiRenderTarget=6]=`MultiRenderTarget`,e[e.Cube=7]=`Cube`,e[e.CubeRaw=8]=`CubeRaw`,e[e.CubePrefiltered=9]=`CubePrefiltered`,e[e.Raw3D=10]=`Raw3D`,e[e.Raw2DArray=11]=`Raw2DArray`,e[e.DepthStencil=12]=`DepthStencil`,e[e.CubeRawRGBD=13]=`CubeRawRGBD`,e[e.Depth=14]=`Depth`})(Le||={});var J=class e extends Ie{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(n,r,i=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url=``,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new t,this.onErrorObservable=new t,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension=``,this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=n,this._source=r,this._uniqueId=e._Counter++,i||(this._hardwareTexture=n._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,n=1){this._engine.updateTextureDimensions(this,e,t,n),this.width=e,this.height=t,this.depth=n,this.baseWidth=e,this.baseHeight=t,this.baseDepth=n,this._size=e*t*n}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){let e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};e.isAsync?e.proxy.then(t):t(e.proxy);return}let e;switch(this.source){case 2:break;case 1:e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,e=>{e._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case 3:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case 10:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 11:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case 4:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null);return;case 8:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,e=>{e&&e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension),e._sphericalPolynomial=this._sphericalPolynomial;return;case 12:case 14:break}}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);let n=this._engine.getLoadedTexturesCache(),r=n.indexOf(this);r!==-1&&n.splice(r,1),r=n.indexOf(e),r===-1&&n.push(e)}dispose(){this._references--,this._references===0&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}};J._Counter=0;const Y=new Map;function X(e,t){Re(e)&&n.Warn(`Extension with the name '${e}' already exists`),Y.set(e,t)}function Re(e){return Y.delete(e)}function ze(t,n){(n===`image/ktx`||n===`image/ktx2`)&&(t=`.ktx`),Y.has(t)||(t.endsWith(`.ies`)&&X(`.ies`,async()=>await e(()=>import(`./iesTextureLoader-Bs3Z4jf9.js`),__vite__mapDeps([0,1,2,3])).then(e=>new e._IESTextureLoader)),t.endsWith(`.dds`)&&X(`.dds`,async()=>await e(()=>import(`./ddsTextureLoader-C_dyr4ma.js`),__vite__mapDeps([4,5,6,7,3,8,9,10,11,12,13,14,2,15,16,17,18,19,20,21,22,23])).then(e=>new e._DDSTextureLoader)),t.endsWith(`.basis`)&&X(`.basis`,async()=>await e(()=>import(`./basisTextureLoader-CmKH5Lh5.js`),__vite__mapDeps([24,12,13,11,14,2,3,15,16,17,10,21,25,26])).then(e=>new e._BasisTextureLoader)),t.endsWith(`.env`)&&X(`.env`,async()=>await e(()=>import(`./envTextureLoader-DuZ_VzvB.js`),__vite__mapDeps([27,28,6,7,3,8,5,9,10,11,12,13,14,2,15,16,17,18,19,26,21,29,23])).then(e=>new e._ENVTextureLoader)),t.endsWith(`.hdr`)&&X(`.hdr`,async()=>await e(()=>import(`./hdrTextureLoader-B3k-5JfX.js`),__vite__mapDeps([30,13,11,31,14,2,3,15])).then(e=>new e._HDRTextureLoader)),(t.endsWith(`.ktx`)||t.endsWith(`.ktx2`))&&(X(`.ktx`,async()=>await e(()=>import(`./ktxTextureLoader-BtADH-zV.js`),__vite__mapDeps([32,13,11,21,33,26,17,16,10,15])).then(e=>new e._KTXTextureLoader)),X(`.ktx2`,async()=>await e(()=>import(`./ktxTextureLoader-BtADH-zV.js`),__vite__mapDeps([32,13,11,21,33,26,17,16,10,15])).then(e=>new e._KTXTextureLoader))),t.endsWith(`.tga`)&&X(`.tga`,async()=>await e(()=>import(`./tgaTextureLoader-C_wOL0Z0.js`),__vite__mapDeps([34,35,10])).then(e=>new e._TGATextureLoader)),t.endsWith(`.exr`)&&X(`.exr`,async()=>await e(()=>import(`./exrTextureLoader-DKPZgAlo.js`),__vite__mapDeps([36,13,11,21,37,2,3,26,17,16,10,15])).then(e=>new e._ExrTextureLoader)));let r=Y.get(t);return r?Promise.resolve(r(n)):null}function Z(e,t){if(l()){let{requestAnimationFrame:n}=t||window;if(typeof n==`function`)return n(e)}else if(typeof requestAnimationFrame==`function`)return requestAnimationFrame(e);return setTimeout(e,16)}var Q=class e{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}_resetAlphaMode(){this._alphaMode.fill(-1),this._alphaEquation.fill(-1)}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE=``:delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER=``:delete e.USE_REVERSE_DEPTHBUFFER,this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS=``:delete e.USE_EXACT_SRGB_CONVERSIONS;return}else{let e=``;return this.isNDCHalfZRange&&(e+=`#define IS_NDC_HALF_ZRANGE`),this.useReverseDepthBuffer&&(e&&(e+=`
`),e+=`#define USE_REVERSE_DEPTHBUFFER`),this.useExactSrgbConversions&&(e&&(e+=`
`),e+=`#define USE_EXACT_SRGB_CONVERSIONS`),e}}_rebuildInternalTextures(){let e=this._internalTexturesCache.slice();for(let t of e)t._rebuild()}_rebuildRenderTargetWrappers(){let e=this._renderTargetWrapperCache.slice();for(let t of e)t._rebuild()}_rebuildEffects(){for(let e in this._compiledEffects){let t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}K.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){n.Warn(this.name+` context successfully restored.`),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout(()=>{this._clearEmptyResources();let t=this._depthCullingState.depthTest,n=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,i=this._stencilState.stencilTest;e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=n,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=i,this._flagContextRestored()},0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return`AbstractEngine`}get emptyTexture(){return this._emptyTexture||=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){let e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e){this._activeRenderLoops.length=0,this._cancelFrame();return}let t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),this._activeRenderLoops.length==0&&this._cancelFrame())}_cancelFrame(){if(this._frameHandler!==0){let e=this._frameHandler;if(this._frameHandler=0,l()){let{cancelAnimationFrame:t}=this.getHostWindow()||window;if(typeof t==`function`)return t(e)}else if(typeof cancelAnimationFrame==`function`)return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(e){if(this._maxFPS=e,e!==void 0){if(e<=0){this._minFrameTime=Number.MAX_VALUE;return}this._minFrameTime=1e3/e}}_isOverFrameTime(e){if(!e||this._maxFPS===void 0)return!1;let t=e-this._lastFrameTime;return this._lastFrameTime=e,this._renderAccumulator+=t,this._renderAccumulator<this._minFrameTime?!0:(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(e){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(e)){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),!this.skipFrameRender&&!this._renderViews()&&this._renderFrame(),this.endFrame())}}_renderLoop(e){this._processFrame(e),this._activeRenderLoops.length>0&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){let t=this._activeRenderLoops[e];t()}}_renderViews(){return!1}_queueNewFrame(e,t){return Z(e,t)}runRenderLoop(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._activeRenderLoops.length===1&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){let e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){let e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return l()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(let e of this.scenes)e._rebuildTextures();for(let e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){let t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,n){let r=t||this.getRenderWidth(),i=n||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*r,o*i,r*e.width,i*e.height)}createCanvasImage(){return document.createElement(`img`)}createCanvasPath2D(e){return new Path2D(e)}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=` - Parallel shader compilation`),e}_createTextureBase(t,i,a,o,s=3,c=null,l=null,u,d,f=null,p=null,m=null,h=null,g,_,v){t||=``;let y=t.substring(0,5)===`data:`,b=t.substring(0,5)===`blob:`,x=y&&t.indexOf(`;base64,`)!==-1,S=p||new J(this,1);S!==p&&(S.label=t.substring(0,60));let C=t;this._transformTextureUrl&&!x&&!p&&!f&&(t=this._transformTextureUrl(t)),C!==t&&(S._originalUrl=C);let w=t.lastIndexOf(`.`),T=h||(w>-1?t.substring(w).toLowerCase():``),E=T.indexOf(`?`);E>-1&&(T=T.split(`?`)[0]);let D=ze(T,g);o&&o.addPendingData(S),S.url=t,S.generateMipMaps=!i,S.samplingMode=s,S.invertY=a,S._useSRGBBuffer=this._getUseSRGBBuffer(!!v,i),this._doNotHandleContextLost||(S._buffer=f);let O=null;c&&!p&&(O=S.onLoadedObservable.add(c)),p||this._internalTexturesCache.push(S);let k=(e,a)=>{o&&o.removePendingData(S),t===C?(O&&S.onLoadedObservable.remove(O),r.UseFallbackTexture&&t!==r.FallbackTexture&&this._createTextureBase(r.FallbackTexture,i,S.invertY,o,s,null,l,u,d,f,S),e=(e||`Unknown error`)+(r.UseFallbackTexture?` - Fallback texture was used`:``),S.onErrorObservable.notifyObservers({message:e,exception:a}),l&&l(e,a)):(n.Warn(`Failed to load ${t}, falling back to ${C}`),this._createTextureBase(C,i,S.invertY,o,s,c,l,u,d,f,S,m,h,g,_,v))};if(D){let e=async e=>{let t=await D;t.loadData(e,S,(e,t,n,r,i,a)=>{a?k(`TextureLoader failed to load data`):u(S,T,o,{width:e,height:t},S.invertY,!n,r,()=>(i(),!1),s)},_)};f?f instanceof ArrayBuffer?e(new Uint8Array(f)):ArrayBuffer.isView(f)?e(f):l&&l(`Unable to load: only ArrayBuffer or ArrayBufferView is supported`,null):this._loadFile(t,t=>{e(new Uint8Array(t))},void 0,o?o.offlineProvider:void 0,!0,(e,t)=>{k(`Unable to load `+(e&&e.responseURL,t))})}else{let n=e=>{b&&!this._doNotHandleContextLost&&(S._buffer=e),u(S,T,o,e,S.invertY,i,!1,d,s)};!y||x?f&&(typeof f.decoding==`string`||f.close)?n(f):e._FileToolsLoadImage(t||``,n,k,o?o.offlineProvider:null,g,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:`flipY`}:void 0,this):typeof f==`string`||f instanceof ArrayBuffer||ArrayBuffer.isView(f)||f instanceof Blob?e._FileToolsLoadImage(f,n,k,o?o.offlineProvider:null,g,S.invertY&&this._features.needsInvertingBitmap?{imageOrientation:`flipY`}:void 0,this):f&&n(f)}return S}_rebuildBuffers(){for(let e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:s()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(let e in this._boundTexturesCache){if(!Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e))continue;this._boundTexturesCache[e]=null}this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return`babylonjs@8.20.0`}static get Version(){return`8.20.0`}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,n,o){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Ne,this._stencilStateComposer=new Pe,this._stencilState=new q,this._alphaState=new Fe,this._alphaMode=Array(8).fill(-1),this._alphaEquation=Array(8).fill(-1),this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=[],this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new t,this.onCanvasFocusObservable=new t,this.onNewSceneAddedObservable=new t,this.onResizeObservable=new t,this.onCanvasPointerOutObservable=new t,this.onEffectErrorObservable=new t,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=[],this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=[],this.onBeforeTextureInitObservable=new t,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=[],this._windowIsBackground=!1,this._boundRenderFunction=e=>this._renderLoop(e),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new t,this.onAfterShaderCompilationObservable=new t,this.onBeginFrameObservable=new t,this.onEndFrameObservable=new t,this._transformTextureUrl=null,this._uniformBuffers=[],this._storageBuffers=[],this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new t,this.onContextRestoredObservable=new t,this._name=``,this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=[`main`],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new t,this.onReleaseEffectsObservable=new t,r.Instances.push(this),this.startTime=a.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,i.SetMatrixPrecision(!!n.useHighPrecisionMatrix),c()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=o??!1,n.antialias=e??n.antialias,n.deterministicLockstep=n.deterministicLockstep??!1,n.lockstepMaxSteps=n.lockstepMaxSteps??4,n.timeStep=n.timeStep??1/60,n.stencil=n.stencil??!0,this._audioContext=n.audioEngineOptions?.audioContext??null,this._audioDestination=n.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=n.premultipliedAlpha??!0,this._doNotHandleContextLost=!!n.doNotHandleContextLost,this._isStencilEnable=!!n.stencil,this.useExactSrgbConversions=n.useExactSrgbConversions??!1;let s=l()&&window.devicePixelRatio||1,u=n.limitDeviceRatio||s;o=o||n.adaptToDeviceRatio||!1,this._hardwareScalingLevel=o?1/Math.min(u,s):1,this._lastDevicePixelRatio=s,this._creationOptions=n}resize(e=!1){let t,n;if(this.adaptToDeviceRatio){let e=l()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if(l()&&s())if(this._renderingCanvas){let e=this._renderingCanvas.getBoundingClientRect?.();t=this._renderingCanvas.clientWidth||e?.width||this._renderingCanvas.width*this._hardwareScalingLevel||100,n=this._renderingCanvas.clientHeight||e?.height||this._renderingCanvas.height*this._hardwareScalingLevel||100}else t=window.innerWidth,n=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,n=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,n/this._hardwareScalingLevel,e)}setSize(e,t,n=!1){if(!this._renderingCanvas||(e|=0,t|=0,!n&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t))return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){let t=this.scenes[e];for(let e=0;e<t.cameras.length;e++){let n=t.cameras[e];n._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,n,r,i,a,o,s,c,l,u){throw f(`engine.rawTexture`)}createRawCubeTexture(e,t,n,r,i,a,o,s){throw f(`engine.rawTexture`)}createRawTexture3D(e,t,n,r,i,a,o,s,c,l,u){throw f(`engine.rawTexture`)}createRawTexture2DArray(e,t,n,r,i,a,o,s,c,l,u){throw f(`engine.rawTexture`)}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{let e=navigator.userAgent;this.hostInformation.isMobile=e.indexOf(`Mobile`)!==-1||e.indexOf(`Mac`)!==-1&&s()&&`ontouchend`in document},this._checkForMobile(),l()&&window.addEventListener(`resize`,this._checkForMobile))}createVideoElement(e){return document.createElement(`video`)}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return this._timeStep*1e3}_createImageBitmapFromSource(e,t){throw Error(`createImageBitmapFromSource is not implemented`)}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,n){throw Error(`resizeImageBitmap is not implemented`)}getFontOffset(e){throw Error(`getFontOffset is not implemented`)}static _CreateCanvas(e,t){if(typeof document>`u`)return new OffscreenCanvas(e,t);let n=document.createElement(`canvas`);return n.width=e,n.height=t,n}createCanvas(t,n){return e._CreateCanvas(t,n)}static _FileToolsLoadImage(e,t,n,r,i,a,o){throw f(`FileTools`)}_loadFile(e,t,n,r,i,a){let o=E(e,t,n,r,i,a);return this._activeRequests.push(o),o.onCompleteObservable.add(()=>{let e=this._activeRequests.indexOf(o);e!==-1&&this._activeRequests.splice(e,1)}),o}static _FileToolsLoadFile(e,t,n,r,i,a){if(w.loadFile)return w.loadFile(e,t,n,r,i,a);throw f(`FileTools`)}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();this.releaseComputeEffects?.(),K.ResetCache();for(let e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),l()&&window.removeEventListener(`resize`,this._checkForMobile);let e=r.Instances.indexOf(this);e>=0&&r.Instances.splice(e,1),r.Instances.length||(r.OnEnginesDisposedObservable.notifyObservers(this),r.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw f(`LoadingScreen`)}static MarkAllMaterialsAsDirty(e,t){for(let n=0;n<r.Instances.length;n++){let i=r.Instances[n];for(let n=0;n<i.scenes.length;n++)i.scenes[n].markAllMaterialsAsDirty(e,t)}}};Q._RenderPassIdCounter=0,Q._RescalePostProcessFactory=null,Q.CollisionsEpsilon=.001,Q.QueueNewFrame=Z;function Be(e){let t=1;do t*=2;while(t<e);return t===e}function Ve(e,t,n){return e*(1-n)+t*n}function He(e){let t=Ue(e),n=$(e);return t-e>e-n?n:t}function Ue(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}function $(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e-(e>>1)}function We(e,t,n=2){let r;switch(n){case 1:r=$(e);break;case 2:r=He(e);break;case 3:default:r=Ue(e);break}return Math.min(r,t)}export{he as A,oe as B,M as C,ae as D,N as E,R as F,pe as G,w as H,T as I,D as J,O as K,f as L,$ as b,We as c,Be as d,Ve as e,He as f,Q as g,ze as h,J as i,Ie as j,Pe as k,Ne as l,K as m,Oe as n,U as o,Ee as p,W as q,Se as r,Ce as s,Te as t,xe as u,ye as v,be as w,ve as x,H as y,me as z};