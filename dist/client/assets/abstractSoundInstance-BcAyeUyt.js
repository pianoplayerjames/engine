import{c as e}from"./observable-8SYwW91n.js";import{i as t}from"./webAudioBaseSubGraph-CYcHX6iU.js";import{b as n}from"./abstractSoundSource-Bjf8sHTp.js";var r=class extends n{constructor(t,n){super(t,n,3),this._newestInstance=null,this._privateInstances=new Set,this._state=1,this._instances=this._privateInstances,this.onEndedObservable=new e,this._onInstanceEnded=e=>{this._newestInstance===e&&(this._newestInstance=null),this._privateInstances.delete(e),this._instances.size===0&&(this._state=1,this.onEndedObservable.notifyObservers(this))}}get autoplay(){return this._options.autoplay}get currentTime(){let e=this._getNewestInstance();return e?e.currentTime:0}set currentTime(e){this.startOffset=e;let t=this._getNewestInstance();t&&(t.currentTime=e)}get loop(){return this._options.loop}set loop(e){this._options.loop=e}get maxInstances(){return this._options.maxInstances}set maxInstances(e){this._options.maxInstances=e}get startOffset(){return this._options.startOffset}set startOffset(e){this._options.startOffset=e}get state(){return this._state}dispose(){super.dispose(),this.stop(),this._newestInstance=null,this._privateInstances.clear(),this.onEndedObservable.clear()}pause(){let e=this._instances.values();for(let t=e.next();!t.done;t=e.next())t.value.pause();this._state=5}resume(){if(this._state!==5)return;let e=this._instances.values();for(let t=e.next();!t.done;t=e.next())t.value.resume();this._state=3}_beforePlay(e){if(this.state===5&&this._instances.size>0){this.resume();return}e.onEndedObservable.addOnce(this._onInstanceEnded),this._privateInstances.add(e),this._newestInstance=e}_afterPlay(e){this._state=e.state}_getNewestInstance(){if(this._instances.size===0)return null;if(!this._newestInstance){let e=this._instances.values();for(let t=e.next();!t.done;t=e.next())this._newestInstance=t.value}return this._newestInstance}_setState(e){this._state=e}_stopExcessInstances(){if(this.maxInstances<1/0){let e=Array.from(this._instances).filter(e=>e.state===3).length-this.maxInstances,t=this._instances.values();for(let n=0;n<e;n++){let e=t.next().value;e.stop()}}}},i=class extends t{constructor(t){super(t.engine,2),this._state=1,this.onEndedObservable=new e,this.onErrorObservable=new e,this.onStateChangedObservable=new e,this._sound=t}get state(){return this._state}dispose(){super.dispose(),this.stop(),this.onEndedObservable.clear(),this.onStateChangedObservable.clear()}_setState(e){this._state!==e&&(this._state=e,this.onStateChangedObservable.notifyObservers(this))}};export{i as b,r as c};